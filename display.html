<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÂâµÊô∫ÂãïËÉΩ 2026 - ÂüéÂ∏ÇÂª∫Ë®≠</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');

    :root {
      /* Âç°ÈÄöÂèØÊÑõÈ¢®ÈÖçËâ≤ */
      --primary: #FF6B9D;
      --secondary: #FFD93D;
      --success: #6BCB77;
      --info: #4D96FF;
      --danger: #FF6B6B;
      --purple: #C86BFA;
      --bg-sky: #87CEEB;
      --bg-card: rgba(255,255,255,0.95);
      --text: #4A4A4A;
      --text-light: #FFFFFF;
      --ground: #8BC34A;
      --ground-dark: #689F38;
      --shadow: rgba(0,0,0,0.15);
    }

    body {
      font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif;
      background: linear-gradient(180deg, #4FC3F7 0%, #81D4FA 30%, #B3E5FC 50%, #E1F5FE 70%);
      color: var(--text);
      min-height: 100vh;
      overflow: hidden;
    }

    .display-container {
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ===== È†ÇÈÉ®Ê®ôÈ°åÂàó - ÈÄèÊòéÁÑ°ËÉåÊôØ ===== */
    .top-bar {
      background: transparent;
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 10;
      position: relative;
    }

    .game-title {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo {
      width: 60px;
      height: auto;
      filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
    }

    .title-text h1 {
      font-size: 1.8rem;
      font-weight: 900;
      color: #333;
      letter-spacing: 2px;
      text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
    }

    .title-text .slogan {
      font-size: 0.9rem;
      color: #555;
      font-weight: 600;
      margin-top: 2px;
      text-shadow: 1px 1px 1px rgba(255,255,255,0.8);
    }

    .stats-bar {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .stat-item {
      text-align: center;
      background: rgba(255, 255, 255, 0.9);
      padding: 8px 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border: 2px solid #e0e0e0;
    }

    .stat-value {
      font-size: 1.8rem;
      font-weight: 900;
      color: #333;
    }

    .stat-label {
      font-size: 0.75rem;
      color: #888;
      margin-top: 2px;
      font-weight: 500;
    }

    .status-badge {
      padding: 10px 20px;
      font-size: 1rem;
      font-weight: 700;
      border-radius: 25px;
      border: none;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }

    .status-badge.building {
      background: #4CAF50;
      color: #fff;
    }
    .status-badge.event {
      background: #FF9800;
      color: #fff;
    }
    .status-badge.waiting {
      background: #2196F3;
      color: #fff;
    }
    .status-badge.ended {
      background: #E91E63;
      color: #fff;
    }

    /* ===== ‰∏ªË¶ÅÂüéÂ∏ÇÂçÄÂüü ===== */
    .city-area {
      flex: 1;
      position: relative;
      overflow: hidden;
    }

    /* Â§©Á©∫ËÉåÊôØ - ÂèØÊÑõËóçÂ§© */
    .sky {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 60%;
      /* ÁßªÈô§ËÉåÊôØÔºå‰ΩøÁî® body ÁöÑÊº∏Â±§ËÉåÊôØÔºåÈÅøÂÖçÂàÜÁïåÁ∑ö */
      background: transparent;
    }

    /* Èö±ËóèÊòüÊòüÔºàÁôΩÂ§©‰∏çÈúÄË¶ÅÔºâ*/
    .stars {
      display: none;
    }

    /* ÂèØÊÑõÂ§™ÈôΩ */
    .sun {
      position: absolute;
      top: 8%;
      right: 10%;
      width: 120px;
      height: 120px;
      background: radial-gradient(circle, #FFF9C4 0%, #FFD93D 50%, #FFC107 100%);
      border-radius: 50%;
      box-shadow:
        0 0 60px rgba(255,217,61,0.6),
        0 0 100px rgba(255,193,7,0.4);
      animation: sunHappy 3s ease-in-out infinite;
    }

    /* Â§™ÈôΩË°®ÊÉÖ */
    .sun::before {
      content: '‚ó°‚Äø‚ó°';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2rem;
      color: #FF9800;
    }

    @keyframes sunHappy {
      0%, 100% {
        transform: scale(1) rotate(0deg);
        box-shadow: 0 0 60px rgba(255,217,61,0.6), 0 0 100px rgba(255,193,7,0.4);
      }
      50% {
        transform: scale(1.05) rotate(5deg);
        box-shadow: 0 0 80px rgba(255,217,61,0.7), 0 0 120px rgba(255,193,7,0.5);
      }
    }

    /* ÂèØÊÑõÈõ≤Êúµ */
    .clouds {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 250px;
      overflow: hidden;
    }

    .cloud {
      position: absolute;
      background: white;
      border-radius: 50px;
      opacity: 0.95;
      animation: cloudFloat 50s linear infinite;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }

    .cloud::before, .cloud::after {
      content: '';
      position: absolute;
      background: white;
      border-radius: 50%;
    }

    .cloud-1 {
      width: 120px;
      height: 50px;
      top: 50px;
      left: -150px;
      animation-duration: 45s;
    }
    .cloud-1::before { width: 60px; height: 60px; top: -30px; left: 20px; }
    .cloud-1::after { width: 45px; height: 45px; top: -20px; left: 65px; }

    .cloud-2 {
      width: 150px;
      height: 60px;
      top: 100px;
      left: -200px;
      animation-duration: 55s;
      animation-delay: -20s;
    }
    .cloud-2::before { width: 70px; height: 70px; top: -35px; left: 30px; }
    .cloud-2::after { width: 55px; height: 55px; top: -25px; left: 85px; }

    .cloud-3 {
      width: 100px;
      height: 45px;
      top: 160px;
      left: -130px;
      animation-duration: 60s;
      animation-delay: -35s;
    }
    .cloud-3::before { width: 50px; height: 50px; top: -25px; left: 15px; }
    .cloud-3::after { width: 40px; height: 40px; top: -18px; left: 55px; }

    @keyframes cloudFloat {
      from { transform: translateX(0); }
      to { transform: translateX(calc(100vw + 250px)); }
    }

    /* Âú∞Èù¢ - ÂèØÊÑõËçâÂú∞ */
    .ground-area {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 38%;
      background: linear-gradient(180deg,
        #8BC34A 0%,
        #7CB342 30%,
        #689F38 60%,
        #558B2F 100%
      );
      border-top: 6px solid #9CCC65;
    }

    /* ËçâÂú∞Ë£ùÈ£æ - Â∞èËä± */
    .ground-area::before {
      content: 'üå∏ üåº üå∏ üåº üå∏ üåº üå∏ üåº üå∏ üåº üå∏ üåº üå∏ üåº üå∏ üåº üå∏ üåº üå∏ üåº';
      position: absolute;
      top: -5px;
      left: 0;
      right: 0;
      font-size: 1.2rem;
      letter-spacing: 30px;
      opacity: 0.8;
      animation: flowerSway 4s ease-in-out infinite;
    }

    @keyframes flowerSway {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-3px); }
    }

    /* ÈÅìË∑Ø - ÂèØÊÑõÈ¢®Ê†º */
    .road {
      position: absolute;
      bottom: 50px;
      left: 0;
      right: 0;
      height: 55px;
      background: linear-gradient(180deg, #78909C 0%, #607D8B 50%, #546E7A 100%);
      border-top: 5px solid #90A4AE;
      border-bottom: 5px solid #455A64;
      border-radius: 0;
    }

    .road::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 8px;
      background: repeating-linear-gradient(90deg,
        #FFFFFF 0px, #FFFFFF 50px,
        transparent 50px, transparent 100px
      );
      transform: translateY(-50%);
      border-radius: 4px;
    }

    /* ‰∫∫Ë°åÈÅì - ÂèØÊÑõÁ£öÂ°ä */
    .sidewalk {
      position: absolute;
      bottom: 105px;
      left: 0;
      right: 0;
      height: 30px;
      background: linear-gradient(180deg, #FFCCBC 0%, #FFAB91 100%);
      border-top: 4px solid #FFE0B2;
      border-bottom: 4px solid #FF8A65;
    }

    .sidewalk::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: repeating-linear-gradient(90deg,
        transparent 0px, transparent 38px,
        rgba(255,255,255,0.3) 38px, rgba(255,255,255,0.3) 40px
      );
    }

    /* Âª∫ÁØâÁâ©ÂçÄÂüü - Â§öÂ±§Áî±ËøëËÄåÈÅ† */
    .buildings-container {
      position: absolute;
      bottom: 135px;
      left: 20px;
      right: 340px;
      top: 200px;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      pointer-events: none;
      overflow: hidden;
    }

    /* Âª∫ÁØâÊéí */
    .building-row {
      display: flex;
      align-items: flex-end;
      justify-content: center;
      gap: 6px;
      padding: 0 10px;
      flex-wrap: wrap;
      position: relative;
    }

    /* ÂæåÊéíÔºàÈÅ†ËôïÔºâ- ÊúÄÂ∞è */
    .building-row.row-back {
      transform: scale(0.5);
      transform-origin: bottom center;
      filter: brightness(0.75) saturate(0.75);
      z-index: 1;
      margin-bottom: -40px;
    }

    /* ‰∏≠Êéí */
    .building-row.row-mid {
      transform: scale(0.72);
      transform-origin: bottom center;
      filter: brightness(0.88) saturate(0.88);
      z-index: 2;
      margin-bottom: -20px;
    }

    /* ÂâçÊéíÔºàËøëËôïÔºâ- ÊúÄÂ§ß */
    .building-row.row-front {
      transform: scale(1);
      z-index: 3;
    }

    /* ÂñÆÂÄãÂª∫ÁØâ */
    .building {
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: buildPop 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      cursor: default;
      pointer-events: auto;
    }

    /* Áé©ÂÆ∂ÂêçÁ®±Ê®ôÁ±§ */
    .building-owner {
      margin-top: 4px;
      padding: 2px 8px;
      background: rgba(255,255,255,0.9);
      border-radius: 10px;
      font-size: 0.7rem;
      font-weight: 600;
      color: #5D4037;
      white-space: nowrap;
      max-width: 70px;
      overflow: hidden;
      text-overflow: ellipsis;
      box-shadow: 0 2px 4px rgba(0,0,0,0.15);
      border: 2px solid #FFB6C1;
    }

    @keyframes buildPop {
      0% {
        transform: scale(0) translateY(30px);
        opacity: 0;
      }
      60% {
        transform: scale(1.1) translateY(-10px);
      }
      100% {
        transform: scale(1) translateY(0);
        opacity: 1;
      }
    }

    /* Â∑≤Â≠òÂú®ÁöÑÂª∫ÁØâ‰∏çË¶ÅÂãïÁï´ */
    .building.no-animation {
      animation: none;
    }

    .building:hover .css-building {
      transform: scale(1.1) translateY(-5px);
    }

    /* ===== CSS Âç°ÈÄöÂª∫ÁØâ - Âõ∫ÂÆöÂ∞∫ÂØ∏‰∏çËÆäÂΩ¢ ===== */
    .css-building {
      position: relative;
      transition: transform 0.3s ease;
      filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.2));
    }

    .building:hover .css-building {
      transform: scale(1.1) translateY(-5px);
    }

    /* ÂâçÊéíÂª∫ÁØâÂ∞∫ÂØ∏ */
    .building-row.row-front .css-building {
      transform: scale(1);
    }

    /* ‰∏≠ÊéíÂª∫ÁØâÂ∞∫ÂØ∏ */
    .building-row.row-mid .css-building {
      transform: scale(0.85);
    }

    /* ÂæåÊéíÂª∫ÁØâÂ∞∫ÂØ∏ */
    .building-row.row-back .css-building {
      transform: scale(0.7);
    }

    /* === ‰ΩèÂÆÖ HOUSE === */
    .b-house {
      width: 50px;
      height: 55px;
    }
    .b-house .body {
      position: absolute;
      bottom: 0;
      left: 5px;
      width: 40px;
      height: 35px;
      background: linear-gradient(135deg, #FFCDD2 0%, #EF9A9A 100%);
      border-radius: 4px;
    }
    .b-house .roof {
      position: absolute;
      top: 0;
      left: 0;
      width: 0;
      height: 0;
      border-left: 25px solid transparent;
      border-right: 25px solid transparent;
      border-bottom: 25px solid #E57373;
    }
    .b-house .door {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 12px;
      height: 18px;
      background: #8D6E63;
      border-radius: 2px 2px 0 0;
    }
    .b-house .window {
      position: absolute;
      top: 25px;
      width: 10px;
      height: 10px;
      background: #81D4FA;
      border: 2px solid #fff;
      border-radius: 2px;
    }
    .b-house .window.left { left: 10px; }
    .b-house .window.right { right: 10px; }

    /* === ÂÖ¨ÂØì APARTMENT === */
    .b-apartment {
      width: 45px;
      height: 70px;
    }
    .b-apartment .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 45px;
      height: 70px;
      background: linear-gradient(135deg, #90CAF9 0%, #64B5F6 100%);
      border-radius: 4px 4px 0 0;
    }
    .b-apartment .window-row {
      position: absolute;
      left: 5px;
      right: 5px;
      display: flex;
      justify-content: space-between;
    }
    .b-apartment .window-row:nth-child(2) { top: 8px; }
    .b-apartment .window-row:nth-child(3) { top: 24px; }
    .b-apartment .window-row:nth-child(4) { top: 40px; }
    .b-apartment .win {
      width: 12px;
      height: 12px;
      background: #FFF9C4;
      border-radius: 2px;
    }
    .b-apartment .door {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 14px;
      height: 16px;
      background: #5D4037;
      border-radius: 2px 2px 0 0;
    }

    /* === Ë±™ÂÆÖ MANSION === */
    .b-mansion {
      width: 65px;
      height: 65px;
    }
    .b-mansion .body {
      position: absolute;
      bottom: 0;
      left: 5px;
      width: 55px;
      height: 45px;
      background: linear-gradient(135deg, #CE93D8 0%, #BA68C8 100%);
      border-radius: 4px;
    }
    .b-mansion .roof {
      position: absolute;
      top: 5px;
      left: 0;
      width: 65px;
      height: 20px;
      background: #7B1FA2;
      clip-path: polygon(10% 100%, 0% 0%, 100% 0%, 90% 100%);
    }
    .b-mansion .tower {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 15px;
      height: 25px;
      background: #9C27B0;
      border-radius: 3px 3px 0 0;
    }
    .b-mansion .flag {
      position: absolute;
      top: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 6px solid #FFD93D;
      border-top: 4px solid transparent;
      border-bottom: 4px solid transparent;
    }

    /* === ÂïÜÂ∫ó SHOP === */
    .b-shop {
      width: 50px;
      height: 50px;
    }
    .b-shop .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 50px;
      height: 40px;
      background: linear-gradient(135deg, #FFCC80 0%, #FFB74D 100%);
      border-radius: 4px 4px 0 0;
    }
    .b-shop .awning {
      position: absolute;
      top: 0;
      left: -3px;
      width: 56px;
      height: 15px;
      background: repeating-linear-gradient(90deg, #F44336 0px, #F44336 8px, #fff 8px, #fff 16px);
      border-radius: 0 0 8px 8px;
    }
    .b-shop .window-big {
      position: absolute;
      top: 18px;
      left: 5px;
      right: 5px;
      height: 18px;
      background: #E1F5FE;
      border: 2px solid #fff;
      border-radius: 2px;
    }

    /* === È§êÂª≥ RESTAURANT === */
    .b-restaurant {
      width: 55px;
      height: 55px;
    }
    .b-restaurant .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 55px;
      height: 45px;
      background: linear-gradient(135deg, #A5D6A7 0%, #81C784 100%);
      border-radius: 4px 4px 0 0;
    }
    .b-restaurant .sign {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 35px;
      height: 15px;
      background: #C62828;
      border-radius: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
    }
    .b-restaurant .window-big {
      position: absolute;
      top: 18px;
      left: 8px;
      right: 8px;
      height: 15px;
      background: #FFF8E1;
      border: 2px solid #fff;
      border-radius: 2px;
    }
    .b-restaurant .door {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 16px;
      height: 14px;
      background: #5D4037;
      border-radius: 2px 2px 0 0;
    }

    /* === È£ØÂ∫ó HOTEL === */
    .b-hotel {
      width: 55px;
      height: 80px;
    }
    .b-hotel .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 55px;
      height: 80px;
      background: linear-gradient(135deg, #FFAB91 0%, #FF8A65 100%);
      border-radius: 4px 4px 0 0;
    }
    .b-hotel .top {
      position: absolute;
      top: 0;
      left: 15px;
      width: 25px;
      height: 10px;
      background: #E64A19;
      border-radius: 3px 3px 0 0;
    }
    .b-hotel .h-sign {
      position: absolute;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 12px;
      background: #FFD93D;
      border-radius: 2px;
      font-size: 9px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #E64A19;
    }

    /* === ÁôæË≤® MALL === */
    .b-mall {
      width: 70px;
      height: 70px;
    }
    .b-mall .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 70px;
      height: 60px;
      background: linear-gradient(135deg, #F8BBD9 0%, #F48FB1 100%);
      border-radius: 6px 6px 0 0;
    }
    .b-mall .roof-deco {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 15px;
      background: #E91E63;
      border-radius: 8px 8px 0 0;
    }
    .b-mall .windows {
      position: absolute;
      top: 20px;
      left: 5px;
      right: 5px;
      height: 35px;
      background: #E1F5FE;
      border: 3px solid #fff;
      border-radius: 3px;
    }

    /* === Â∑•Âª† FACTORY === */
    .b-factory {
      width: 65px;
      height: 60px;
    }
    .b-factory .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 50px;
      height: 45px;
      background: linear-gradient(135deg, #B0BEC5 0%, #90A4AE 100%);
      border-radius: 4px 4px 0 0;
    }
    .b-factory .chimney {
      position: absolute;
      bottom: 40px;
      right: 0;
      width: 15px;
      height: 30px;
      background: #78909C;
      border-radius: 2px 2px 0 0;
    }
    .b-factory .smoke {
      position: absolute;
      top: -15px;
      right: 2px;
      width: 12px;
      height: 12px;
      background: #ECEFF1;
      border-radius: 50%;
      animation: smokeFloat 2s ease-in-out infinite;
    }
    @keyframes smokeFloat {
      0%, 100% { transform: translateY(0) scale(1); opacity: 0.8; }
      50% { transform: translateY(-8px) scale(1.2); opacity: 0.4; }
    }

    /* === ÂÄâÂ∫´ WAREHOUSE === */
    .b-warehouse {
      width: 55px;
      height: 45px;
    }
    .b-warehouse .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 55px;
      height: 35px;
      background: linear-gradient(135deg, #BCAAA4 0%, #A1887F 100%);
      border-radius: 2px;
    }
    .b-warehouse .roof {
      position: absolute;
      top: 0;
      left: 0;
      width: 55px;
      height: 12px;
      background: #795548;
      clip-path: polygon(0% 100%, 5% 0%, 95% 0%, 100% 100%);
    }
    .b-warehouse .door-big {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 25px;
      height: 25px;
      background: #5D4037;
      border-radius: 2px 2px 0 0;
    }

    /* === ÁßëÊäÄÂúíÂçÄ TECHPARK === */
    .b-techpark {
      width: 60px;
      height: 65px;
    }
    .b-techpark .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 60px;
      height: 55px;
      background: linear-gradient(135deg, #B2EBF2 0%, #80DEEA 100%);
      border-radius: 8px 8px 0 0;
    }
    .b-techpark .glass {
      position: absolute;
      top: 10px;
      left: 5px;
      right: 5px;
      bottom: 10px;
      background: linear-gradient(135deg, #E0F7FA 0%, #B2EBF2 100%);
      border-radius: 4px;
      border: 2px solid #4DD0E1;
    }
    .b-techpark .antenna {
      position: absolute;
      top: -10px;
      right: 15px;
      width: 4px;
      height: 15px;
      background: #00ACC1;
    }
    .b-techpark .antenna::after {
      content: '';
      position: absolute;
      top: -4px;
      left: -3px;
      width: 10px;
      height: 10px;
      background: #4DD0E1;
      border-radius: 50%;
      animation: blink 1.5s ease-in-out infinite;
    }
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    /* === ÂÖ¨Âúí PARK === */
    .b-park {
      width: 55px;
      height: 55px;
    }
    .b-park .ground {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 55px;
      height: 15px;
      background: #A5D6A7;
      border-radius: 8px;
    }
    .b-park .tree {
      position: absolute;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
    }
    .b-park .trunk {
      width: 8px;
      height: 15px;
      background: #8D6E63;
      margin: 0 auto;
      border-radius: 2px;
    }
    .b-park .leaves {
      width: 35px;
      height: 35px;
      background: radial-gradient(circle, #81C784 0%, #66BB6A 50%, #4CAF50 100%);
      border-radius: 50%;
      margin-bottom: -5px;
    }
    .b-park .flower {
      position: absolute;
      bottom: 10px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
    .b-park .flower.f1 { left: 5px; background: #FF80AB; }
    .b-park .flower.f2 { right: 5px; background: #FFD54F; }

    /* === Â≠∏Ê†° SCHOOL === */
    .b-school {
      width: 65px;
      height: 55px;
    }
    .b-school .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 65px;
      height: 45px;
      background: linear-gradient(135deg, #FFF59D 0%, #FFF176 100%);
      border-radius: 4px 4px 0 0;
    }
    .b-school .roof {
      position: absolute;
      top: 0;
      left: 0;
      width: 65px;
      height: 12px;
      background: #FBC02D;
      border-radius: 4px 4px 0 0;
    }
    .b-school .clock {
      position: absolute;
      top: 14px;
      left: 50%;
      transform: translateX(-50%);
      width: 14px;
      height: 14px;
      background: #fff;
      border-radius: 50%;
      border: 2px solid #F57F17;
    }
    .b-school .windows-row {
      position: absolute;
      top: 32px;
      left: 5px;
      right: 5px;
      display: flex;
      justify-content: space-between;
    }
    .b-school .win {
      width: 14px;
      height: 12px;
      background: #E3F2FD;
      border: 2px solid #fff;
      border-radius: 2px;
    }

    /* === ÈÜ´Èô¢ HOSPITAL === */
    .b-hospital {
      width: 55px;
      height: 70px;
    }
    .b-hospital .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 55px;
      height: 70px;
      background: linear-gradient(135deg, #FFFFFF 0%, #F5F5F5 100%);
      border-radius: 4px 4px 0 0;
      border: 2px solid #E0E0E0;
    }
    .b-hospital .cross {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 18px;
      height: 18px;
      background: #EF5350;
      clip-path: polygon(35% 0%, 65% 0%, 65% 35%, 100% 35%, 100% 65%, 65% 65%, 65% 100%, 35% 100%, 35% 65%, 0% 65%, 0% 35%, 35% 35%);
    }
    .b-hospital .entrance {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 20px;
      background: #90CAF9;
      border-radius: 4px 4px 0 0;
    }

    /* === È´îËÇ≤Â†¥ STADIUM === */
    .b-stadium {
      width: 75px;
      height: 50px;
    }
    .b-stadium .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 75px;
      height: 35px;
      background: linear-gradient(135deg, #E1BEE7 0%, #CE93D8 100%);
      border-radius: 50% 50% 4px 4px;
    }
    .b-stadium .field {
      position: absolute;
      bottom: 5px;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 18px;
      background: #81C784;
      border-radius: 4px;
      border: 2px solid #fff;
    }
    .b-stadium .lights {
      position: absolute;
      top: 0;
      width: 6px;
      height: 20px;
      background: #9E9E9E;
    }
    .b-stadium .lights.l1 { left: 10px; }
    .b-stadium .lights.l2 { right: 10px; }
    .b-stadium .light-top {
      position: absolute;
      top: -5px;
      left: -2px;
      width: 10px;
      height: 8px;
      background: #FFEB3B;
      border-radius: 2px;
    }

    /* === Âú∞Ê®ô LANDMARK === */
    .b-landmark {
      width: 45px;
      height: 85px;
    }
    .b-landmark .base {
      position: absolute;
      bottom: 0;
      left: 5px;
      width: 35px;
      height: 25px;
      background: linear-gradient(135deg, #FFCCBC 0%, #FFAB91 100%);
      border-radius: 4px;
    }
    .b-landmark .tower {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 50px;
      background: linear-gradient(135deg, #FF8A65 0%, #FF7043 100%);
      border-radius: 2px;
    }
    .b-landmark .top {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 12px solid transparent;
      border-right: 12px solid transparent;
      border-bottom: 18px solid #E64A19;
    }
    .b-landmark .antenna {
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 3px;
      height: 12px;
      background: #BF360C;
    }

    /* === Â§™Á©∫Á´ô SPACEPORT === */
    .b-spaceport {
      width: 60px;
      height: 80px;
    }
    .b-spaceport .base {
      position: absolute;
      bottom: 0;
      left: 5px;
      width: 50px;
      height: 20px;
      background: linear-gradient(135deg, #B0BEC5 0%, #90A4AE 100%);
      border-radius: 4px;
    }
    .b-spaceport .rocket {
      position: absolute;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 50px;
      background: linear-gradient(135deg, #E0E0E0 0%, #BDBDBD 100%);
      border-radius: 10px 10px 0 0;
    }
    .b-spaceport .rocket-top {
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-bottom: 15px solid #EF5350;
    }
    .b-spaceport .fin {
      position: absolute;
      bottom: 0;
      width: 0;
      height: 0;
      border-top: 12px solid transparent;
      border-bottom: 0 solid transparent;
    }
    .b-spaceport .fin.left {
      left: -8px;
      border-right: 10px solid #78909C;
    }
    .b-spaceport .fin.right {
      right: -8px;
      border-left: 10px solid #78909C;
    }
    .b-spaceport .window {
      position: absolute;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      width: 10px;
      height: 10px;
      background: #4FC3F7;
      border-radius: 50%;
      border: 2px solid #0288D1;
    }
    .b-spaceport .flame {
      position: absolute;
      bottom: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 12px;
      height: 20px;
      background: linear-gradient(180deg, #FF9800 0%, #FF5722 50%, transparent 100%);
      border-radius: 0 0 6px 6px;
      animation: flameFlicker 0.3s ease-in-out infinite alternate;
    }
    @keyframes flameFlicker {
      0% { transform: translateX(-50%) scaleY(1); }
      100% { transform: translateX(-50%) scaleY(0.8); }
    }


    /* ÊéíË°åÊ¶úÂÅ¥ÈÇäÊ¨Ñ - Âç°ÈÄöÂèØÊÑõÈ¢®Ê†º */
    .side-panel {
      position: absolute;
      top: 100px;
      right: 20px;
      width: 320px;
      background: var(--bg-card);
      border-radius: 25px;
      border: 4px solid #FFD93D;
      box-shadow: 0 8px 30px rgba(255,107,157,0.2), inset 0 2px 0 rgba(255,255,255,0.8);
      padding: 20px;
      max-height: calc(100vh - 200px);
      overflow-y: auto;
    }

    .panel-title {
      font-size: 1.3rem;
      font-weight: 900;
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      gap: 12px;
      color: #FF6B9D;
      border-bottom: 3px dashed #FFB6C1;
      padding-bottom: 12px;
    }

    .leaderboard-item {
      display: flex;
      align-items: center;
      padding: 12px 15px;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #FFF5F8 0%, #FFE4EC 100%);
      border-radius: 15px;
      border: 3px solid #FFB6C1;
      transition: all 0.3s ease;
    }

    .leaderboard-item:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 5px 15px rgba(255,107,157,0.3);
    }

    .leaderboard-item:nth-child(1) {
      background: linear-gradient(135deg, #FFF8E1 0%, #FFECB3 100%);
      border-color: #FFD54F;
      box-shadow: 0 4px 15px rgba(255,213,79,0.3);
    }

    .leaderboard-item:nth-child(2) {
      background: linear-gradient(135deg, #F5F5F5 0%, #E0E0E0 100%);
      border-color: #BDBDBD;
    }

    .leaderboard-item:nth-child(3) {
      background: linear-gradient(135deg, #FFCCBC 0%, #FFAB91 100%);
      border-color: #FF8A65;
    }

    .rank {
      font-size: 1.4rem;
      font-weight: 900;
      width: 40px;
      text-align: center;
    }

    .rank-1 { color: #FFC107; text-shadow: 1px 1px 0 #FF8F00; }
    .rank-2 { color: #9E9E9E; text-shadow: 1px 1px 0 #616161; }
    .rank-3 { color: #FF8A65; text-shadow: 1px 1px 0 #E64A19; }

    .player-info {
      flex: 1;
      margin-left: 12px;
    }

    .player-name {
      font-size: 1.1rem;
      font-weight: 700;
      color: #5D4037;
    }

    .player-buildings {
      font-size: 0.85rem;
      color: #8D6E63;
      margin-top: 3px;
    }

    .player-score {
      font-size: 1.3rem;
      font-weight: 900;
      color: #FF6B9D;
      text-shadow: 1px 1px 0 rgba(255,107,157,0.3);
    }

    /* ‰∫ã‰ª∂ÂÖ¨Âëä - Âç°ÈÄöÂèØÊÑõÈ¢®Ê†º */
    .event-panel {
      position: absolute;
      top: 100px;
      left: 20px;
      width: 400px;
      background: var(--bg-card);
      border-radius: 25px;
      border: 4px solid #FFD93D;
      box-shadow: 0 8px 30px rgba(255,107,157,0.2), inset 0 2px 0 rgba(255,255,255,0.8);
      padding: 22px;
      display: none;
    }

    .event-panel.show {
      display: block;
      animation: eventPopIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes eventPopIn {
      0% { transform: scale(0.5) rotate(-10deg); opacity: 0; }
      60% { transform: scale(1.1) rotate(3deg); }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }

    .event-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 15px;
      border-bottom: 3px dashed #FFB6C1;
      padding-bottom: 15px;
    }

    .event-icon {
      font-size: 3rem;
      filter: drop-shadow(2px 3px 0 rgba(0,0,0,0.15));
      animation: eventIconWiggle 1s ease-in-out infinite;
    }

    @keyframes eventIconWiggle {
      0%, 100% { transform: rotate(-5deg); }
      50% { transform: rotate(5deg); }
    }

    .event-title {
      font-size: 1.4rem;
      font-weight: 900;
      color: #FF6B9D;
    }

    .event-type {
      font-size: 0.95rem;
      color: #8D6E63;
      font-weight: 500;
    }

    .event-description {
      font-size: 1.1rem;
      margin-bottom: 15px;
      line-height: 1.6;
      color: #5D4037;
    }

    .event-effects {
      background: linear-gradient(135deg, #FFF5F8 0%, #FFE4EC 100%);
      border-radius: 15px;
      padding: 15px;
      border: 2px solid #FFB6C1;
    }

    .effect-title {
      font-size: 0.9rem;
      color: #8D6E63;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .effect-text {
      font-size: 1.1rem;
      font-weight: 700;
    }

    .effect-text.positive { color: #4CAF50; }
    .effect-text.negative { color: #EF5350; }

    /* Âª∫ÁØâÁµ±Ë®àÊ¨Ñ - Âç°ÈÄöÂèØÊÑõÈ¢®Ê†º */
    .stats-panel {
      position: absolute;
      bottom: 15px;
      left: 20px;
      right: 360px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .category-badge {
      background: var(--bg-card);
      border-radius: 20px;
      border: 3px solid #4FC3F7;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 10px 18px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      font-weight: 500;
      color: #5D4037;
    }

    .category-badge:hover {
      transform: translateY(-4px) scale(1.05);
      box-shadow: 0 8px 20px rgba(79,195,247,0.3);
      border-color: #29B6F6;
    }

    .category-badge .emoji {
      font-size: 1.5rem;
    }

    .category-badge .count {
      font-weight: 900;
      color: #FF6B9D;
      font-size: 1.2rem;
    }

    /* ===== Á≠âÂæÖÁï´Èù¢ - Âç°ÈÄöÂèØÊÑõÈ¢®Ê†º ===== */
    .waiting-overlay {
      position: fixed;
      inset: 0;
      background: linear-gradient(180deg,
        #87CEEB 0%,
        #B4E7FF 30%,
        #E8F8FF 60%,
        #FFF5F8 100%
      );
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
      padding: 20px;
      overflow: hidden;
    }

    .waiting-content-wrapper {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 60px;
      max-width: 1400px;
      width: 100%;
      height: 100%;
      position: relative;
      z-index: 1;
    }

    .waiting-left-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .waiting-right-section {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Á≠âÂæÖÁï´Èù¢Ë£ùÈ£æ - È£ÑÂãïÁöÑÊÑõÂøÉÂíåÊòüÊòü */
    .waiting-overlay::before {
      content: '‚ù§Ô∏è ‚≠ê üíñ ‚ú® üíï üåü üíó ‚≠ê ‚ù§Ô∏è ‚ú® üíñ üåü';
      position: absolute;
      top: 50px;
      left: 0;
      right: 0;
      font-size: 2rem;
      text-align: center;
      letter-spacing: 40px;
      animation: floatDecor 4s ease-in-out infinite;
      opacity: 0.6;
    }

    .waiting-overlay::after {
      content: 'üè† üè¢ üè™ üè≠ üè´ üè• üèüÔ∏è üóº üöÄ';
      position: absolute;
      bottom: 80px;
      left: 0;
      right: 0;
      font-size: 2.5rem;
      text-align: center;
      letter-spacing: 30px;
      animation: floatBuildings 3s ease-in-out infinite;
    }

    @keyframes floatDecor {
      0%, 100% { transform: translateY(0) rotate(-2deg); }
      50% { transform: translateY(-15px) rotate(2deg); }
    }

    @keyframes floatBuildings {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }

    .waiting-overlay.hidden {
      display: none;
    }

    /* ===== Â∞èÈÅäÊà≤È°ØÁ§∫ÂçÄ ===== */
    .minigame-overlay {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, rgba(255, 107, 157, 0.95) 0%, rgba(200, 107, 250, 0.95) 100%);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 200;
      padding: 40px;
    }

    .minigame-overlay.show {
      display: flex;
    }

    .minigame-content {
      background: var(--bg-card);
      border-radius: 32px;
      padding: 50px;
      max-width: 900px;
      width: 100%;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
    }

    .minigame-title {
      font-size: 3rem;
      font-weight: 900;
      margin-bottom: 30px;
      color: var(--primary);
    }

    .minigame-icon {
      font-size: 6rem;
      margin-bottom: 20px;
      animation: bounce 1s ease-in-out infinite;
    }

    /* Âø´ÂïèÂø´Á≠îÊ®£Âºè */
    .quiz-question {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 30px;
      color: var(--text);
      line-height: 1.4;
    }

    .quiz-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }

    .quiz-option {
      background: linear-gradient(135deg, var(--info) 0%, #2196F3 100%);
      color: white;
      padding: 25px;
      border-radius: 16px;
      font-size: 1.5rem;
      font-weight: bold;
      border: none;
      cursor: not-allowed;
      box-shadow: 0 4px 12px rgba(77, 150, 255, 0.4);
    }

    .quiz-progress {
      font-size: 1.2rem;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .quiz-timer {
      font-size: 2rem;
      font-weight: 900;
      color: var(--danger);
    }

    /* ÂñùÂï§ÈÖíÊØîË≥ΩÊ®£Âºè */
    .beer-status {
      font-size: 1.5rem;
      margin-bottom: 30px;
      color: var(--text);
    }

    .beer-participants {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
    }

    .beer-participant {
      background: var(--bg);
      padding: 20px 30px;
      border-radius: 16px;
      font-size: 1.3rem;
      font-weight: bold;
      border: 3px solid var(--warning);
    }

    .beer-results {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 30px;
    }

    .beer-result-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--bg);
      padding: 20px 30px;
      border-radius: 16px;
      font-size: 1.5rem;
    }

    .beer-result-item.rank-1 {
      border: 4px solid #ffd700;
      background: linear-gradient(135deg, rgba(255,215,0,0.2) 0%, rgba(255,215,0,0.1) 100%);
    }

    .beer-result-item.rank-2 {
      border: 4px solid #c0c0c0;
      background: linear-gradient(135deg, rgba(192,192,192,0.2) 0%, rgba(192,192,192,0.1) 100%);
    }

    .beer-rank {
      font-size: 2rem;
      font-weight: 900;
    }

    .beer-rank.rank-1 { color: #ffd700; }
    .beer-rank.rank-2 { color: #c0c0c0; }
    .beer-rank.rank-3 { color: #cd7f32; }

    /* ÊØîÂ§ßÂ∞èÊ®£Âºè */
    .poker-betting {
      font-size: 1.8rem;
      margin-bottom: 30px;
      color: var(--text);
    }

    .poker-timer {
      font-size: 3rem;
      font-weight: 900;
      color: var(--warning);
      margin-bottom: 20px;
    }

    .poker-card-display {
      font-size: 8rem;
      margin: 30px 0;
      animation: cardFlip 0.6s ease-out;
    }

    @keyframes cardFlip {
      0% { transform: rotateY(0deg); }
      50% { transform: rotateY(90deg); }
      100% { transform: rotateY(0deg); }
    }

    .poker-result {
      font-size: 2.5rem;
      font-weight: 900;
      margin-bottom: 30px;
    }

    .poker-result.big { color: var(--success); }
    .poker-result.small { color: var(--danger); }

    .poker-winners-losers {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-top: 30px;
    }

    .poker-list {
      background: var(--bg);
      padding: 20px;
      border-radius: 16px;
    }

    .poker-list-title {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 15px;
    }

    .poker-list-title.winners { color: var(--success); }
    .poker-list-title.losers { color: var(--danger); }

    .poker-list-items {
      font-size: 1.2rem;
      line-height: 1.8;
    }

    .waiting-logo {
      font-size: 6rem;
      margin-bottom: 20px;
      filter: drop-shadow(4px 6px 0 rgba(255,107,157,0.4));
      animation: logoHop 0.8s ease-in-out infinite;
      position: relative;
      z-index: 1;
    }

    @keyframes logoHop {
      0%, 100% { transform: translateY(0) scale(1) rotate(-3deg); }
      50% { transform: translateY(-25px) scale(1.05) rotate(3deg); }
    }

    .waiting-logo-img {
      max-width: 300px;
      width: 100%;
      height: auto;
      margin-bottom: 15px;
      filter: drop-shadow(4px 6px 0 rgba(255,107,157,0.2));
      position: relative;
      z-index: 1;
    }

    .waiting-title {
      font-size: 3rem;
      font-weight: 900;
      color: #FF6B9D;
      text-shadow: 3px 3px 0 #fff, 6px 6px 0 rgba(255,107,157,0.3);
      margin-bottom: 15px;
      position: relative;
      z-index: 1;
      letter-spacing: 5px;
    }

    .waiting-subtitle {
      font-size: 1.3rem;
      color: #8B5A8B;
      margin-bottom: 25px;
      position: relative;
      z-index: 1;
      font-weight: 600;
      text-align: center;
    }

    .waiting-players {
      font-size: 1.2rem;
      color: #5D4037;
      position: relative;
      z-index: 1;
      background: var(--bg-card);
      padding: 25px 50px;
      border-radius: 25px;
      border: 4px solid #FFD93D;
      box-shadow: 0 8px 30px rgba(255,107,157,0.2);
      font-weight: 500;
      text-align: center;
    }

    .waiting-players span {
      color: #FF6B9D;
      font-weight: 900;
      font-size: 2.5rem;
    }

    .qr-hint {
      padding: 30px 60px;
      background: var(--bg-card);
      border-radius: 30px;
      border: 4px solid #4FC3F7;
      box-shadow: 0 8px 30px rgba(79,195,247,0.2);
      text-align: center;
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 500px;
    }

    .qr-hint p {
      color: #5D4037;
      margin-bottom: 18px;
      font-size: 1.1rem;
      font-weight: 500;
    }

    .qr-url {
      font-size: 1.4rem;
      font-weight: 900;
      color: #4FC3F7;
    }

    /* ===== ÁµêÊùüÁï´Èù¢ - Âç°ÈÄöÂèØÊÑõÈ¢®Ê†º ===== */
    .end-overlay {
      position: fixed;
      inset: 0;
      background: linear-gradient(180deg,
        #FFE4EC 0%,
        #FFF5F8 30%,
        #E8F8FF 60%,
        #E1F5FE 100%
      );
      display: none;
      flex-direction: column;
      padding: 40px;
      z-index: 100;
    }

    .end-overlay.show {
      display: flex;
    }

    .end-title {
      font-size: 3.5rem;
      font-weight: 900;
      text-align: center;
      margin-bottom: 30px;
      color: #FF6B9D;
      text-shadow: 3px 3px 0 #fff, 6px 6px 0 rgba(255,107,157,0.3);
      animation: celebrateBounce 1s ease-in-out infinite;
    }

    @keyframes celebrateBounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.03); }
    }

    /* ‰∏äÊñπÂª∫ÁØâÂ±ïÁ§∫ÂçÄÂüü */
    .end-buildings-display {
      width: 100%;
      height: 400px;
      position: relative;
      margin-bottom: 30px;
    }

    .final-city-ground {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 100px;
      background: linear-gradient(180deg, #8BC34A 0%, #689F38 100%);
    }

    .final-buildings {
      position: absolute;
      bottom: 100px;
      left: 0;
      right: 0;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
      padding: 0 40px;
    }

    /* ===== ÁµêÊùüÁï´Èù¢ÂΩ±ÁâáËàáÊñáÊ°àÂçÄÂüü ===== */
    .end-video-section {
      margin-top: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 40px;
      background: linear-gradient(135deg, rgba(255,107,157,0.1) 0%, rgba(79,195,247,0.1) 100%);
      border-radius: 30px;
      padding: 30px;
      border: 3px solid rgba(255,215,61,0.5);
    }

    .end-video-container {
      flex: 1;
      max-width: 500px;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 8px 30px rgba(0,0,0,0.2);
      border: 4px solid #FFD93D;
    }

    .end-video-container video {
      width: 100%;
      height: auto;
      display: block;
    }

    .end-slogan {
      flex: 1;
      text-align: center;
      padding: 20px;
    }

    .end-slogan p {
      font-size: 1.8rem;
      font-weight: 700;
      color: #5D4037;
      margin: 15px 0;
      text-shadow: 2px 2px 0 #fff;
    }

    .end-slogan .highlight {
      font-size: 2.2rem;
      font-weight: 900;
      color: #FF6B9D;
      background: linear-gradient(90deg, #FF6B9D, #4FC3F7);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: shimmer 2s ease-in-out infinite;
    }

    @keyframes shimmer {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.9; transform: scale(1.02); }
    }

    .final-leaderboard h2 {
      margin-bottom: 20px;
      color: #FF6B9D;
      font-weight: 900;
      font-size: 1.5rem;
    }

    /* ===== ÊäΩÁçéÁï´Èù¢ ===== */
    .lottery-overlay {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 200;
    }

    .lottery-overlay.show {
      display: flex;
    }

    .lottery-title {
      font-size: 3rem;
      font-weight: 900;
      color: #FFD93D;
      text-shadow: 0 0 20px rgba(255,217,61,0.5), 3px 3px 0 rgba(0,0,0,0.3);
      margin-bottom: 20px;
      animation: lotteryTitlePulse 2s ease-in-out infinite;
    }

    @keyframes lotteryTitlePulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }

    .lottery-prize-label {
      font-size: 1.5rem;
      color: #4FC3F7;
      margin-bottom: 30px;
    }

    .lottery-spinner {
      width: 600px;
      height: 200px;
      background: rgba(255,255,255,0.1);
      border-radius: 20px;
      border: 4px solid #FFD93D;
      overflow: hidden;
      position: relative;
      box-shadow: 0 0 50px rgba(255,217,61,0.3), inset 0 0 30px rgba(0,0,0,0.5);
    }

    .lottery-spinner::before,
    .lottery-spinner::after {
      content: '';
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100px;
      z-index: 10;
      pointer-events: none;
    }

    .lottery-spinner::before {
      left: 0;
      background: linear-gradient(90deg, rgba(26,26,46,1) 0%, rgba(26,26,46,0) 100%);
    }

    .lottery-spinner::after {
      right: 0;
      background: linear-gradient(90deg, rgba(26,26,46,0) 0%, rgba(26,26,46,1) 100%);
    }

    .lottery-names-track {
      display: flex;
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      transition: transform 0.1s linear;
    }

    .lottery-names-track.stopping {
      transition: transform 3s cubic-bezier(0.1, 0.7, 0.1, 1);
    }

    .lottery-name-item {
      flex-shrink: 0;
      width: 200px;
      height: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 0 10px;
      background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.05) 100%);
      border-radius: 15px;
      border: 2px solid rgba(255,255,255,0.2);
      color: white;
    }

    .lottery-name-item.winner {
      background: linear-gradient(135deg, #FFD93D 0%, #FFC107 100%);
      border-color: #FF9800;
      color: #1a1a2e;
      transform: scale(1.1);
      box-shadow: 0 0 30px rgba(255,217,61,0.8);
    }

    .lottery-name-item .name {
      font-size: 1.8rem;
      font-weight: 900;
    }

    .lottery-name-item .score {
      font-size: 1rem;
      opacity: 0.8;
      margin-top: 5px;
    }

    .lottery-pointer {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-top: 30px solid #FF6B9D;
      filter: drop-shadow(0 3px 5px rgba(0,0,0,0.3));
      z-index: 20;
    }

    .lottery-pointer-bottom {
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-bottom: 30px solid #FF6B9D;
      filter: drop-shadow(0 -3px 5px rgba(0,0,0,0.3));
      z-index: 20;
    }

    .lottery-winner-display {
      margin-top: 40px;
      text-align: center;
      min-height: 150px;
    }

    .lottery-winner-name {
      font-size: 4rem;
      font-weight: 900;
      color: #FFD93D;
      text-shadow: 0 0 30px rgba(255,217,61,0.8);
      animation: winnerCelebrate 0.5s ease-in-out infinite alternate;
    }

    @keyframes winnerCelebrate {
      0% { transform: scale(1); }
      100% { transform: scale(1.05); }
    }

    .lottery-winner-score {
      font-size: 1.5rem;
      color: #4FC3F7;
      margin-top: 10px;
    }

    .lottery-hint {
      margin-top: 30px;
      font-size: 1.2rem;
      color: rgba(255,255,255,0.6);
    }

    .lottery-winners-list {
      position: absolute;
      right: 40px;
      top: 50%;
      transform: translateY(-50%);
      width: 280px;
      max-height: 70vh;
      background: rgba(0,0,0,0.4);
      border-radius: 20px;
      padding: 20px;
      overflow-y: auto;
    }

    .lottery-winners-list h3 {
      color: #FFD93D;
      font-size: 1.2rem;
      margin-bottom: 15px;
      text-align: center;
    }

    .lottery-winner-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      margin-bottom: 8px;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      color: white;
    }

    .lottery-winner-item .rank {
      width: 30px;
      height: 30px;
      background: #FF6B9D;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 0.9rem;
    }

    .lottery-winner-item .rank.gold { background: #FFD93D; color: #1a1a2e; }
    .lottery-winner-item .rank.silver { background: #C0C0C0; color: #1a1a2e; }
    .lottery-winner-item .rank.bronze { background: #CD7F32; color: white; }

    .lottery-confetti {
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
    }

    .confetti-piece {
      position: absolute;
      width: 10px;
      height: 20px;
      opacity: 0;
    }

    .confetti-piece.animate {
      animation: confettiFall 3s ease-out forwards;
    }

    @keyframes confettiFall {
      0% {
        opacity: 1;
        transform: translateY(-100px) rotate(0deg);
      }
      100% {
        opacity: 0;
        transform: translateY(100vh) rotate(720deg);
      }
    }
  </style>
</head>
<body>
  <div class="display-container">
    <!-- È†ÇÈÉ®Ê®ôÈ°åÂàó -->
    <div class="top-bar">
      <div class="game-title">
        <img src="https://firebasestorage.googleapis.com/v0/b/christmas-tree-3fe6b.firebasestorage.app/o/logo%2F%E8%B3%87%E7%94%A2%208.png?alt=media&token=7519dfc2-7df3-4dd7-bb82-000c27ed3f67" alt="Logo" class="logo">
        <div class="title-text">
          <h1>ÂâµÊô∫ÂãïËÉΩ 2026</h1>
          <p class="slogan">‚ú® ÁúæÂøóÊàêÂüé„ÉªÁØâÂ§¢ÊàêÁúü ‚ú®</p>
        </div>
      </div>

      <div class="stats-bar">
        <div class="stat-item">
          <div class="stat-value" id="total-buildings">0</div>
          <div class="stat-label">Âª∫ÁØâÁ∏ΩÊï∏</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="total-players">0</div>
          <div class="stat-label">ÂèÉËàá‰∫∫Êï∏</div>
        </div>
      </div>

      <div class="status-badge waiting" id="status-badge">Á≠âÂæÖ‰∏≠</div>
    </div>

    <!-- ÂüéÂ∏ÇÂçÄÂüü -->
    <div class="city-area">
      <!-- Â§©Á©∫ -->
      <div class="sky"></div>
      <div class="stars"></div>

      <!-- Â§™ÈôΩ -->
      <div class="sun"></div>

      <!-- Èõ≤Êúµ -->
      <div class="clouds">
        <div class="cloud cloud-1"></div>
        <div class="cloud cloud-2"></div>
        <div class="cloud cloud-3"></div>
      </div>

      <!-- Âú∞Èù¢ -->
      <div class="ground-area"></div>

      <!-- ‰∫∫Ë°åÈÅì -->
      <div class="sidewalk"></div>

      <!-- ÈÅìË∑Ø -->
      <div class="road"></div>

      <!-- Âª∫ÁØâÁâ© -->
      <div class="buildings-container" id="buildings-container">
        <!-- ÂãïÊÖãÁîüÊàêÂª∫ÁØâ -->
      </div>

      <!-- ‰∫ã‰ª∂ÂÖ¨Âëä -->
      <div class="event-panel" id="event-panel" onclick="hideEvent()" style="cursor: pointer;">
        <div class="event-header">
          <span class="event-icon" id="event-icon">üì¢</span>
          <div>
            <div class="event-type" id="event-type">‰∫ã‰ª∂</div>
            <div class="event-title" id="event-title">--</div>
          </div>
        </div>
        <div class="event-description" id="event-description">--</div>
        <div class="event-effects">
          <div class="effect-title">ÁáüÊî∂Âä†ÊàêÔºàÈáëÂπ£ÔºãË≤¢ÁçªÂàÜÔºâ</div>
          <div class="effect-text" id="event-effects">--</div>
        </div>
        <div style="margin-top: 10px; font-size: 0.8rem; color: rgba(255,255,255,0.6);">ÈªûÊìäÈóúÈñâ</div>
      </div>

      <!-- ÊéíË°åÊ¶ú -->
      <div class="side-panel">
        <div class="panel-title">üèÜ Ë≤¢ÁçªÊéíË°åÊ¶ú</div>
        <div id="leaderboard">
          <!-- ÂãïÊÖãÁîüÊàê -->
        </div>
      </div>

      <!-- Âª∫ÁØâÁµ±Ë®à -->
      <div class="stats-panel" id="stats-panel">
        <!-- ÂãïÊÖãÁîüÊàê -->
      </div>
    </div>
  </div>

  <!-- Á≠âÂæÖÁï´Èù¢ -->
  <div class="waiting-overlay" id="waiting-overlay">
    <div class="waiting-content-wrapper">
      <!-- Â∑¶ÂÅ¥ÔºöLogo + ÂâØÊ®ôÈ°å -->
      <div class="waiting-left-section">
        <div class="waiting-logo">üèóÔ∏è</div>
        <img src="https://firebasestorage.googleapis.com/v0/b/christmas-tree-3fe6b.firebasestorage.app/o/logo%2F%E8%B3%87%E7%94%A2%2081.png?alt=media&token=46ed0dd8-94a3-414a-8e07-b253908e08ec"
             alt="ÂâµÊô∫ÂãïËÉΩ Logo"
             class="waiting-logo-img">
        <div class="waiting-subtitle">‚ú® ÁúæÂøóÊàêÂüé„ÉªÁØâÂ§¢ÊàêÁúü ‚ú®</div>
        <div class="waiting-players">
          ÁõÆÂâç <span id="waiting-player-count">0</span> ‰ΩçÂ§•‰º¥Â∑≤Â∞±‰Ωç
        </div>
      </div>

      <!-- Âè≥ÂÅ¥ÔºöQR Code -->
      <div class="waiting-right-section">
        <div class="qr-hint">
          <p>ÊéÉÊèè QR Code ÊàñËº∏ÂÖ•Á∂≤ÂùÄÂä†ÂÖ•ÈÅäÊà≤</p>
          <div id="qr-code" style="margin: 20px auto; background: white; padding: 15px; border-radius: 8px; display: inline-block;"></div>
          <div class="qr-url" id="game-url">--</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ÊäΩÁçéÁï´Èù¢ -->
  <div class="lottery-overlay" id="lottery-overlay">
    <div class="lottery-confetti" id="lottery-confetti"></div>
    <div class="lottery-title">üé∞ Âπ∏ÈÅãÂ§ßÊäΩÁçé üé∞</div>
    <div class="lottery-prize-label" id="lottery-prize-label">Ê∫ñÂÇôÊäΩÂá∫Âπ∏ÈÅãÂÖí...</div>

    <div class="lottery-spinner">
      <div class="lottery-pointer"></div>
      <div class="lottery-pointer-bottom"></div>
      <div class="lottery-names-track" id="lottery-names-track">
        <!-- ÂãïÊÖãÁîüÊàêÂêçÂ≠ó -->
      </div>
    </div>

    <div class="lottery-winner-display" id="lottery-winner-display">
      <!-- ‰∏≠ÁçéËÄÖÈ°ØÁ§∫ -->
    </div>

    <div class="lottery-hint" id="lottery-hint">Á≠âÂæÖ‰∏ªÊåÅ‰∫∫ÈñãÂßãÊäΩÁçé...</div>

    <div class="lottery-winners-list" id="lottery-winners-list">
      <h3>üèÜ Â∑≤ÊäΩÂá∫ÂæóÁçéËÄÖ</h3>
      <div id="lottery-winners-container">
        <p style="text-align: center; color: rgba(255,255,255,0.5); font-size: 0.9rem;">Â∞öÊú™ÊäΩÂá∫</p>
      </div>
    </div>
  </div>

  <!-- Â∞èÈÅäÊà≤È°ØÁ§∫ÂçÄ -->
  <div class="minigame-overlay" id="minigame-overlay">
    <div class="minigame-content" id="minigame-content">
      <!-- ÂãïÊÖãÂÖßÂÆπ -->
    </div>
  </div>

  <!-- ÁµêÊùüÁï´Èù¢ -->
  <div class="end-overlay" id="end-overlay">
    <div class="end-title">üéâ ÂâµÊô∫Âüé Âª∫Ë®≠ÂÆåÊàêÔºÅüéâ</div>
    <!-- ‰∏äÊñπÔºöÂüéÂ∏ÇÂª∫ÁØâÂ±ïÁ§∫ -->
    <div class="end-buildings-display">
      <div class="final-buildings" id="final-buildings"></div>
      <div class="final-city-ground"></div>
    </div>
    <!-- ‰∏ãÊñπÔºöÂΩ±ÁâáËàáÊñáÊ°àÂçÄÂüü -->
    <div class="end-video-section">
      <div class="end-video-container">
        <video id="end-video" autoplay loop muted playsinline>
          <source src="https://firebasestorage.googleapis.com/v0/b/christmas-tree-3fe6b.firebasestorage.app/o/VIDEO%2Fgrok-video-b0490a7f-5814-4ead-b9d8-f9aa65d51e30%20(1).mp4?alt=media&token=e954da8d-33cc-4bd6-9f1b-ceddb604ab24" type="video/mp4">
        </video>
      </div>
      <div class="end-slogan">
        <p>üåü Êú™‰æÜÔºåÂ§ßÂÆ∂ÂêÑËá™ÊâÆÊºî‰∏çÂêåËßíËâ≤ÁôºÊèÆÊâÄÈï∑</p>
        <p class="highlight">2026 ÈΩäÂøÉÂçîÂäõÔºåÂâµÈÄ†ÂâµÊô∫ÂãïËÉΩ‰∫ûÂ§™‰ºÅÊ•≠ÁâàÂúñÔºÅ</p>
      </div>
    </div>
  </div>

  <!-- QR Code Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    // ÈÅäÊà≤Ë®≠ÂÆö
    let gameConfig = null;
    let socket = null;

    // ÂàùÂßãÂåñ
    document.addEventListener('DOMContentLoaded', async () => {
      // ÂèñÂæóË®≠ÂÆö
      const configRes = await fetch('/api/config');
      gameConfig = await configRes.json();

      // Ë®≠ÂÆöÈÅäÊà≤Á∂≤ÂùÄ‰∏¶Áî¢Áîü QR Code
      const url = window.location.origin;
      document.getElementById('game-url').textContent = url;

      // Áî¢Áîü QR Code - Á¢∫‰øù QRCode Â∑≤ËºâÂÖ•
      const generateQRCode = () => {
        if (typeof QRCode === 'undefined') {
          console.error('QRCode library not loaded yet, retrying...');
          setTimeout(generateQRCode, 100);
          return;
        }

        try {
          const qrContainer = document.getElementById('qr-code');
          if (qrContainer) {
            qrContainer.innerHTML = ''; // Ê∏ÖÁ©∫ÂÆπÂô®

            // ‰ΩøÁî® qrcodejs Â∫´
            new QRCode(qrContainer, {
              text: url,
              width: 200,
              height: 200,
              colorDark: '#FF6B9D',  // Á≤âÁ¥ÖËâ≤ÔºåÁ¨¶Âêà UI ‰∏ªÈ°å
              colorLight: '#ffffff',
              correctLevel: QRCode.CorrectLevel.H
            });

            console.log('QR Code generated successfully');
          }
        } catch (error) {
          console.error('QR Code generation failed:', error);
        }
      };

      generateQRCode();

      // ÈÄ£Êé• Socket
      socket = io();

      socket.on('connect', () => {
        console.log('Display connected');
        fetchGameState();
      });

      // ÈÅäÊà≤‰∫ã‰ª∂
      socket.on('game:started', handleGameStarted);
      socket.on('game:buildingPhase', handleBuildingPhase);
      socket.on('game:buildingPurchased', handleBuildingPurchased);
      socket.on('game:buildingUpgraded', handleBuildingUpgraded);  // Âª∫ÁØâÂçáÁ¥ö‰∫ã‰ª∂
      socket.on('game:eventTriggered', handleEventTriggered);
      socket.on('game:scoreAdded', handleScoreAdded);
      socket.on('game:ended', handleGameEnded);
      socket.on('game:playerJoined', handlePlayerJoined);
      socket.on('game:reset', handleReset);

      // Â∞èÈÅäÊà≤‰∫ã‰ª∂Áõ£ËÅΩ
      socket.on('minigame:quizStarted', handleQuizStarted);
      socket.on('minigame:quizQuestion', handleQuizQuestion);
      socket.on('minigame:quizEnded', handleQuizEnded);

      socket.on('minigame:beerWaitingStart', handleBeerWaitingStart);
      socket.on('minigame:beerPlayerJoined', handleBeerPlayerJoined);
      socket.on('minigame:beerGameStarted', handleBeerGameStarted);
      socket.on('minigame:beerResultsSet', handleBeerResultsSet);
      socket.on('minigame:beerEnded', handleBeerEnded);

      socket.on('minigame:pokerStarted', handlePokerStarted);
      socket.on('minigame:pokerEnded', handlePokerEnded);

      // ÊäΩÁçé‰∫ã‰ª∂Áõ£ËÅΩ
      socket.on('lottery:start', (data) => {
        resetLottery();
        startLotteryMode(data.players);
      });

      socket.on('lottery:spin', () => {
        if (!isSpinning && lotteryPlayers.length > 0) {
          startSpin();
        }
      });

      socket.on('lottery:stop', () => {
        if (isSpinning) {
          stopSpin();
        }
      });

      socket.on('lottery:next', () => {
        if (!isSpinning && lotteryPlayers.length > 0) {
          document.getElementById('lottery-prize-label').textContent = `Á¨¨ ${currentPrizeIndex} ‰ΩçÂπ∏ÈÅãÂÖí`;
          document.getElementById('lottery-winner-display').innerHTML = '';
          buildNamesTrack();
        }
      });

      socket.on('lottery:close', () => {
        closeLotteryMode();
      });

      // È†íÁçé‰∫ã‰ª∂Áõ£ËÅΩ
      socket.on('award:start', (data) => {
        awardPlayers = data.players.sort((a, b) => (b.score || 0) - (a.score || 0));
        awardPrizeCount = data.prizeCount;
        awardWinners = [];
        currentAwardRank = 0;
        startAwardMode();
      });

      socket.on('award:reveal', (data) => {
        if (currentAwardRank < awardPlayers.length && !isRevealing) {
          revealWinner();
        }
      });

      socket.on('award:close', () => {
        closeAwardMode();
      });
    });

    // ÂèñÂæóÈÅäÊà≤ÁãÄÊÖã
    async function fetchGameState() {
      const res = await fetch('/api/game/state');
      const state = await res.json();
      updateDisplay(state);
    }

    // Êõ¥Êñ∞Áï´Èù¢
    function updateDisplay(state) {
      // Êõ¥Êñ∞Áµ±Ë®à
      document.getElementById('total-buildings').textContent = state.totalBuildings || 0;
      document.getElementById('total-players').textContent = state.playerCount || 0;
      document.getElementById('waiting-player-count').textContent = state.playerCount || 0;

      // Êõ¥Êñ∞ÁãÄÊÖãÊ®ôÁ±§
      updateStatusBadge(state.state);

      // Êõ¥Êñ∞Âª∫ÁØâË¶ñË¶∫ÂåñÔºà‰ΩøÁî®Âª∫ÁØâÂàóË°®Ôºâ
      renderCityBuildings(state.cityBuildings, state.cityBuildingList);

      // Êõ¥Êñ∞ÊéíË°åÊ¶ú
      renderLeaderboard(state.leaderboard);

      // È°ØÁ§∫/Èö±ËóèÁ≠âÂæÖÁï´Èù¢
      const waitingOverlay = document.getElementById('waiting-overlay');
      if (state.state === 'WAITING') {
        waitingOverlay.classList.remove('hidden');
      } else {
        waitingOverlay.classList.add('hidden');
      }

      // È°ØÁ§∫‰∫ã‰ª∂
      if (state.currentEvent && state.state === 'EVENT') {
        showEvent(state.currentEvent);
      }
    }

    // Êõ¥Êñ∞ÁãÄÊÖãÊ®ôÁ±§
    function updateStatusBadge(state) {
      const badge = document.getElementById('status-badge');
      const stateMap = {
        'WAITING': { text: 'Á≠âÂæÖ‰∏≠', class: 'waiting' },
        'BUILDING': { text: 'Âª∫Ë®≠‰∏≠', class: 'building' },
        'EVENT': { text: '‰∫ã‰ª∂ÁôºÁîü', class: 'event' },
        'ENDED': { text: 'Â∑≤ÁµêÊùü', class: 'ended' }
      };
      const info = stateMap[state] || stateMap.WAITING;
      badge.textContent = info.text;
      badge.className = `status-badge ${info.class}`;
    }

    // CSS Âª∫ÁØâÊ®°Êùø
    function createCSSBuilding(buildingId) {
      switch(buildingId) {
        case 'HOUSE':
          return `<div class="css-building b-house">
            <div class="roof"></div>
            <div class="body">
              <div class="window left"></div>
              <div class="window right"></div>
              <div class="door"></div>
            </div>
          </div>`;
        case 'APARTMENT':
          return `<div class="css-building b-apartment">
            <div class="body">
              <div class="window-row"><div class="win"></div><div class="win"></div><div class="win"></div></div>
              <div class="window-row"><div class="win"></div><div class="win"></div><div class="win"></div></div>
              <div class="window-row"><div class="win"></div><div class="win"></div><div class="win"></div></div>
              <div class="door"></div>
            </div>
          </div>`;
        case 'MANSION':
          return `<div class="css-building b-mansion">
            <div class="tower"><div class="flag"></div></div>
            <div class="roof"></div>
            <div class="body"></div>
          </div>`;
        case 'SHOP':
          return `<div class="css-building b-shop">
            <div class="awning"></div>
            <div class="body">
              <div class="window-big"></div>
            </div>
          </div>`;
        case 'RESTAURANT':
          return `<div class="css-building b-restaurant">
            <div class="sign">üçú</div>
            <div class="body">
              <div class="window-big"></div>
              <div class="door"></div>
            </div>
          </div>`;
        case 'HOTEL':
          return `<div class="css-building b-hotel">
            <div class="top"></div>
            <div class="body">
              <div class="h-sign">H</div>
            </div>
          </div>`;
        case 'MALL':
          return `<div class="css-building b-mall">
            <div class="roof-deco"></div>
            <div class="body">
              <div class="windows"></div>
            </div>
          </div>`;
        case 'FACTORY':
          return `<div class="css-building b-factory">
            <div class="chimney"><div class="smoke"></div></div>
            <div class="body"></div>
          </div>`;
        case 'WAREHOUSE':
          return `<div class="css-building b-warehouse">
            <div class="roof"></div>
            <div class="body">
              <div class="door-big"></div>
            </div>
          </div>`;
        case 'TECHPARK':
          return `<div class="css-building b-techpark">
            <div class="antenna"></div>
            <div class="body">
              <div class="glass"></div>
            </div>
          </div>`;
        case 'PARK':
          return `<div class="css-building b-park">
            <div class="tree">
              <div class="leaves"></div>
              <div class="trunk"></div>
            </div>
            <div class="ground"></div>
            <div class="flower f1"></div>
            <div class="flower f2"></div>
          </div>`;
        case 'SCHOOL':
          return `<div class="css-building b-school">
            <div class="roof"></div>
            <div class="body">
              <div class="clock"></div>
              <div class="windows-row">
                <div class="win"></div><div class="win"></div><div class="win"></div><div class="win"></div>
              </div>
            </div>
          </div>`;
        case 'HOSPITAL':
          return `<div class="css-building b-hospital">
            <div class="body">
              <div class="cross"></div>
              <div class="entrance"></div>
            </div>
          </div>`;
        case 'STADIUM':
          return `<div class="css-building b-stadium">
            <div class="lights l1"><div class="light-top"></div></div>
            <div class="lights l2"><div class="light-top"></div></div>
            <div class="body">
              <div class="field"></div>
            </div>
          </div>`;
        case 'LANDMARK':
          return `<div class="css-building b-landmark">
            <div class="antenna"></div>
            <div class="top"></div>
            <div class="tower"></div>
            <div class="base"></div>
          </div>`;
        case 'SPACEPORT':
          return `<div class="css-building b-spaceport">
            <div class="base"></div>
            <div class="rocket">
              <div class="rocket-top"></div>
              <div class="window"></div>
              <div class="fin left"></div>
              <div class="fin right"></div>
              <div class="flame"></div>
            </div>
          </div>`;
        default:
          return `<div class="css-building b-house">
            <div class="roof"></div>
            <div class="body"><div class="door"></div></div>
          </div>`;
      }
    }

    // ËøΩËπ§ÁõÆÂâçÂª∫ÁØâÁãÄÊÖãÔºåÈÅøÂÖçÈáçË§áÊ∏≤ÊüìÂ∞éËá¥ÈñÉÁàç
    let currentBuildingKey = '';

    // ÊØèÊéíÊúÄÂ§öÂπæÊ£üÂª∫ÁØâ
    const BUILDINGS_PER_ROW = 10;

    // Ê∏≤ÊüìÂüéÂ∏ÇÂª∫ÁØâÔºà‰ΩøÁî®Âª∫ÁØâÂàóË°®ÔºåÂê´Áé©ÂÆ∂ÂêçÁ®±Ôºâ
    function renderCityBuildings(cityBuildings, buildingList) {
      const container = document.getElementById('buildings-container');
      const statsPanel = document.getElementById('stats-panel');

      console.log('renderCityBuildings called:', { cityBuildings, buildingList });

      // Âè™‰ΩøÁî®ÊúâÁé©ÂÆ∂ÂêçÁ®±ÁöÑ buildingListÔºå‰∏çÂæû stats ÈáçÂª∫
      // ÈÄôÊ®£ÂèØ‰ª•Á¢∫‰øùÊØèÊ£üÂª∫ÁØâÈÉΩÈ°ØÁ§∫Ê≠£Á¢∫ÁöÑÁé©ÂÆ∂ÂêçÁ®±

      // Â¶ÇÊûúÊ≤íÊúâÂª∫ÁØâÂàóË°®ÔºåÊ∏ÖÁ©∫
      if (!buildingList || buildingList.length === 0) {
        if (currentBuildingKey !== '') {
          container.innerHTML = '';
          currentBuildingKey = '';
        }
        statsPanel.innerHTML = '';
        return;
      }

      // Âª∫Á´ãÂª∫ÁØâ key ‰æÜÊØîËºÉÊòØÂê¶ÊúâËÆäÂåñ
      const newKey = buildingList.map(b => b.id).join(',');

      // Âè™ÊúâÂª∫ÁØâÊúâËÆäÂåñÊôÇÊâçÈáçÊñ∞Ê∏≤Êüì
      if (newKey !== currentBuildingKey) {
        const oldCount = currentBuildingKey ? currentBuildingKey.split(',').filter(x => x).length : 0;
        currentBuildingKey = newKey;

        // Â∞áÂª∫ÁØâÂàÜÊàêÂ§öÊéíÔºàÁî±ËøëËÄåÈÅ†Ôºâ
        const rows = [];
        for (let i = 0; i < buildingList.length; i += BUILDINGS_PER_ROW) {
          rows.push(buildingList.slice(i, i + BUILDINGS_PER_ROW));
        }

        // Ê∏≤ÊüìÂ§öÊéíÂª∫ÁØâ
        let html = '';
        rows.forEach((rowBuildings, rowIndex) => {
          // Ê±∫ÂÆöÂ±§Ê¨°ÔºöÊúÄÂæåÊéíÊòØÂâçÊéíÔºåÊúÄÂâçÊéíÊòØÂæåÊéí
          let rowClass = 'row-front';
          if (rows.length > 1) {
            const fromEnd = rows.length - 1 - rowIndex;
            if (fromEnd >= 2) rowClass = 'row-back';
            else if (fromEnd === 1) rowClass = 'row-mid';
            else rowClass = 'row-front';
          }

          html += `<div class="building-row ${rowClass}">`;
          rowBuildings.forEach((b, indexInRow) => {
            const globalIndex = rowIndex * BUILDINGS_PER_ROW + indexInRow;
            const isNew = globalIndex >= oldCount;
            // Êà™ÂèñÁé©ÂÆ∂ÂêçÂ≠óÔºàÊúÄÂ§ö4ÂÄãÂ≠óÔºâ
            const shortName = b.playerName.length > 4 ? b.playerName.substring(0, 4) + '..' : b.playerName;
            html += `
              <div class="building ${isNew ? '' : 'no-animation'}" style="${isNew ? `animation-delay: ${(globalIndex - oldCount) * 0.08}s` : ''}" title="${b.playerName}">
                ${createCSSBuilding(b.buildingId)}
                <div class="building-owner">${shortName}</div>
              </div>
            `;
          });
          html += '</div>';
        });

        container.innerHTML = html;
      }

      // Ê∏≤ÊüìÂàÜÈ°ûÁµ±Ë®à
      statsPanel.innerHTML = '';
      if (cityBuildings && cityBuildings.categories) {
        for (const [catId, cat] of Object.entries(cityBuildings.categories)) {
          if (cat.count === 0) continue;

          const badge = document.createElement('div');
          badge.className = 'category-badge';
          badge.innerHTML = `
            <span class="emoji">${cat.emoji}</span>
            <span>${cat.name}</span>
            <span class="count">${cat.count}</span>
          `;
          statsPanel.appendChild(badge);
        }
      }
    }

    // Ê∏≤ÊüìÊéíË°åÊ¶ú
    function renderLeaderboard(leaderboard, targetId = 'leaderboard') {
      const list = document.getElementById(targetId);
      if (!leaderboard || leaderboard.length === 0) {
        list.innerHTML = '<p style="color: rgba(255,255,255,0.5); text-align: center; padding: 20px;">Á≠âÂæÖÁé©ÂÆ∂Âä†ÂÖ•...</p>';
        return;
      }

      list.innerHTML = leaderboard.slice(0, 10).map((player, index) => `
        <div class="leaderboard-item">
          <div class="rank rank-${index + 1}">${index + 1}</div>
          <div class="player-info">
            <div class="player-name">${player.name}</div>
            <div class="player-buildings">${player.buildingCount || 0} Ê£üÂª∫ÁØâ</div>
          </div>
          <div class="player-score">${player.score}</div>
        </div>
      `).join('');
    }

    // ‰∫ã‰ª∂Ëá™ÂãïÈö±ËóèË®àÊôÇÂô®
    let eventAutoHideTimer = null;

    // È°ØÁ§∫‰∫ã‰ª∂
    function showEvent(event) {
      const panel = document.getElementById('event-panel');
      const typeMap = {
        'BOOM': 'ÊôØÊ∞£ÁπÅÊ¶Æ',
        'RECESSION': 'ÊôØÊ∞£Ë°∞ÈÄÄ',
        'DISASTER': 'ÁÅΩÈõ£‰∫ã‰ª∂',
        'POLICY': 'ÊîøÁ≠ñÂà©Â§ö',
        'SPECIAL': 'ÁâπÊÆä‰∫ã‰ª∂'
      };

      document.getElementById('event-icon').textContent = event.emoji || 'üì¢';
      document.getElementById('event-type').textContent = typeMap[event.type] || '‰∫ã‰ª∂';
      document.getElementById('event-title').textContent = event.title;
      document.getElementById('event-description').textContent = event.description;

      const effectsEl = document.getElementById('event-effects');
      effectsEl.textContent = event.display?.affected || '--';
      effectsEl.className = `effect-text ${event.display?.mood || ''}`;

      panel.classList.add('show');

      // Ê∏ÖÈô§ËàäË®àÊôÇÂô®‰∏¶Ë®≠ÂÆöÊñ∞ÁöÑËá™ÂãïÈö±ËóèÔºà8ÁßíÂæåÔºâ
      if (eventAutoHideTimer) {
        clearTimeout(eventAutoHideTimer);
      }
      eventAutoHideTimer = setTimeout(() => {
        hideEvent();
      }, 8000);
    }

    // Èö±Ëóè‰∫ã‰ª∂
    function hideEvent() {
      document.getElementById('event-panel').classList.remove('show');
      if (eventAutoHideTimer) {
        clearTimeout(eventAutoHideTimer);
        eventAutoHideTimer = null;
      }
    }

    // ‰∫ã‰ª∂ËôïÁêÜ
    function handleGameStarted(data) {
      document.getElementById('waiting-overlay').classList.add('hidden');
      updateStatusBadge('BUILDING');
    }

    function handleBuildingPhase(data) {
      hideEvent();
      updateStatusBadge('BUILDING');
      // ÈáçÊñ∞ÂèñÂæóÂÆåÊï¥ÁãÄÊÖãÔºàÂåÖÂê´Âª∫ÁØâÂàóË°®Ôºâ
      fetchGameState();
    }

    function handleBuildingPurchased(data) {
      // ÈáçÊñ∞Ê∏≤ÊüìÂª∫ÁØâÔºà‰ΩøÁî®Âª∫ÁØâÂàóË°®Ôºâ
      renderCityBuildings(data.cityBuildings, data.cityBuildingList);

      // Êõ¥Êñ∞Âª∫ÁØâÁ∏ΩÊï∏
      const total = data.cityBuildingList ? data.cityBuildingList.length : 0;
      document.getElementById('total-buildings').textContent = total;
    }

    function handleBuildingUpgraded(data) {
      console.log('üèóÔ∏è Building upgraded:', data);

      // ÈáçÊñ∞Ê∏≤ÊüìÂª∫ÁØâÔºà‰ΩøÁî®Êõ¥Êñ∞ÂæåÁöÑÂª∫ÁØâÂàóË°®Ôºâ
      renderCityBuildings(data.cityBuildings, data.cityBuildingList);

      // Êõ¥Êñ∞Âª∫ÁØâÁ∏ΩÊï∏
      const total = data.cityBuildingList ? data.cityBuildingList.length : 0;
      document.getElementById('total-buildings').textContent = total;

      // ÂèØÈÅ∏ÔºöÈ°ØÁ§∫ÂçáÁ¥öÈÄöÁü•ÔºàÁ∞°ÂñÆÊèêÁ§∫Ôºâ
      console.log(`‚ú® ${data.playerName} ÂçáÁ¥ö‰∫Ü ${data.mergeCount} Ê£ü ${data.fromBuilding.name} ‚Üí ${data.toBuilding.name}ÔºÅ`);
    }

    function handleEventTriggered(data) {
      updateStatusBadge('EVENT');
      showEvent(data.event);
      // ÈáçÊñ∞ÂèñÂæóÂÆåÊï¥ÁãÄÊÖãÔºàÂåÖÂê´Âª∫ÁØâÂàóË°®Ôºâ
      fetchGameState();
      renderLeaderboard(data.leaderboard);
    }

    function handleScoreAdded(data) {
      fetchGameState();
    }

    function handleGameEnded(data) {
      console.log('=== handleGameEnded called ===');
      console.log('Received data:', data);
      console.log('cityBuildingList:', data.cityBuildingList);
      console.log('leaderboard:', data.leaderboard);

      updateStatusBadge('ENDED');

      // È°ØÁ§∫ÁµêÊùüÁï´Èù¢
      const endOverlay = document.getElementById('end-overlay');
      console.log('end-overlay element:', endOverlay);
      endOverlay.classList.add('show');
      console.log('Added show class, classList:', endOverlay.classList);

      // Ê∏≤ÊüìÊúÄÁµÇÂüéÂ∏ÇÔºà‰ΩøÁî®Âª∫ÁØâÂàóË°®ÔºåÂê´Áé©ÂÆ∂ÂêçÁ®±Ôºâ
      const finalBuildings = document.getElementById('final-buildings');
      const buildingList = data.cityBuildingList || [];

      finalBuildings.innerHTML = buildingList.map(b => {
        const shortName = b.playerName.length > 4 ? b.playerName.substring(0, 4) + '..' : b.playerName;
        return `
          <div class="building no-animation" title="${b.playerName}" style="transform: scale(0.6);">
            ${createCSSBuilding(b.buildingId)}
            <div class="building-owner" style="font-size: 0.6rem;">${shortName}</div>
          </div>
        `;
      }).join('');

      // Ê∏≤ÊüìÊúÄÁµÇÊéíË°åÊ¶ú
      renderLeaderboard(data.leaderboard, 'final-leaderboard');
    }

    function handlePlayerJoined(player) {
      fetchGameState();
    }

    function handleReset() {
      document.getElementById('end-overlay').classList.remove('show');
      document.getElementById('waiting-overlay').classList.remove('hidden');
      hideEvent();
      fetchGameState();
    }

    // ÂÆöÊúüÂà∑Êñ∞
    setInterval(fetchGameState, 5000);

    // ========== Â∞èÈÅäÊà≤Á≥ªÁµ± ==========

    let quizCurrentQuestion = null;

    // Âø´ÂïèÂø´Á≠î
    function handleQuizStarted(data) {
      const overlay = document.getElementById('minigame-overlay');
      overlay.innerHTML = `
        <div class="minigame-content">
          <div class="minigame-icon">üí°</div>
          <div class="minigame-title">Âø´ÂïèÂø´Á≠î</div>
          <div class="quiz-status" style="font-size: 1.5rem; color: var(--text);">
            ÈÅäÊà≤ÈñãÂßãÔºÅÂÖ± ${data.questionCount} È°å
          </div>
        </div>
      `;
      overlay.classList.add('show');
    }

    function handleQuizQuestion(data) {
      quizCurrentQuestion = data;
      const overlay = document.getElementById('minigame-overlay');
      overlay.innerHTML = `
        <div class="minigame-content">
          <div class="minigame-title">üí° Âø´ÂïèÂø´Á≠î</div>
          <div class="quiz-progress">Á¨¨ ${data.questionIndex + 1} / ${data.totalQuestions} È°å</div>
          <div class="quiz-question">${data.question}</div>
          <div class="quiz-options">
            ${data.options.map((opt, i) => `
              <div class="quiz-option">${opt}</div>
            `).join('')}
          </div>
          <div class="quiz-timer">ÂÄíÊï∏ ${data.timeLimit} Áßí</div>
        </div>
      `;
      overlay.classList.add('show');
    }

    function handleQuizEnded(data) {
      const overlay = document.getElementById('minigame-overlay');
      const results = data.results.slice(0, 5); // È°ØÁ§∫Ââç5Âêç
      overlay.innerHTML = `
        <div class="minigame-content">
          <div class="minigame-icon">üèÜ</div>
          <div class="minigame-title">Âø´ÂïèÂø´Á≠îÁµêÊûú</div>
          <div class="beer-results" style="max-width: 600px; margin: 0 auto;">
            ${results.map((r, i) => `
              <div class="beer-result-item ${i === 0 ? 'rank-1' : i === 1 ? 'rank-2' : ''}">
                <div style="display: flex; align-items: center; gap: 15px;">
                  <div class="beer-rank rank-${i + 1}">Á¨¨${i + 1}Âêç</div>
                  <div style="font-weight: bold;">${r.playerName}</div>
                </div>
                <div>
                  <span style="color: var(--success); font-weight: bold;">${r.correct}/${r.total}È°å</span>
                  <span style="margin-left: 10px; color: var(--warning);">+${r.reward}ÂàÜ</span>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `;

      setTimeout(() => {
        overlay.classList.remove('show');
      }, 10000);
    }

    // ÂñùÂï§ÈÖíÊØîË≥Ω
    let beerParticipants = [];

    function handleBeerWaitingStart() {
      beerParticipants = [];
      const overlay = document.getElementById('minigame-overlay');
      overlay.innerHTML = `
        <div class="minigame-content">
          <div class="minigame-icon">üç∫</div>
          <div class="minigame-title">ÂñùÂï§ÈÖíÊØîË≥Ω</div>
          <div class="beer-status">Á≠âÂæÖÁé©ÂÆ∂Âä†ÂÖ•...</div>
          <div class="beer-participants" id="beer-participants-display">
            <div style="font-size: 1.2rem; color: var(--text-muted);">Â∞öÁÑ°Áé©ÂÆ∂Âä†ÂÖ•</div>
          </div>
        </div>
      `;
      overlay.classList.add('show');
    }

    function handleBeerPlayerJoined(data) {
      beerParticipants.push(data.playerName);
      const participantsDisplay = document.getElementById('beer-participants-display');
      if (participantsDisplay) {
        participantsDisplay.innerHTML = beerParticipants.map(name => `
          <div class="beer-participant">${name}</div>
        `).join('');
      }
    }

    function handleBeerGameStarted(data) {
      const overlay = document.getElementById('minigame-overlay');
      overlay.innerHTML = `
        <div class="minigame-content">
          <div class="minigame-icon">üç∫</div>
          <div class="minigame-title">ÂñùÂï§ÈÖíÊØîË≥Ω</div>
          <div class="beer-status">ÊØîË≥ΩÈÄ≤Ë°å‰∏≠...</div>
          <div class="beer-participants">
            ${data.participants.map(p => `
              <div class="beer-participant">${p.playerName}</div>
            `).join('')}
          </div>
        </div>
      `;
    }

    function handleBeerResultsSet(data) {
      const overlay = document.getElementById('minigame-overlay');
      overlay.innerHTML = `
        <div class="minigame-content">
          <div class="minigame-icon">üç∫</div>
          <div class="minigame-title">ÂñùÂï§ÈÖíÊØîË≥ΩÁµêÊûú</div>
          <div class="beer-results">
            ${data.results.map(r => `
              <div class="beer-result-item ${r.rank === 1 ? 'rank-1' : r.rank === 2 ? 'rank-2' : ''}">
                <div style="display: flex; align-items: center; gap: 15px;">
                  <div class="beer-rank rank-${r.rank}">Á¨¨${r.rank}Âêç</div>
                  <div style="font-weight: bold; font-size: 1.3rem;">${r.playerName}</div>
                </div>
                <div style="color: var(--warning); font-weight: bold; font-size: 1.2rem;">+${r.reward}ÂàÜ</div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    function handleBeerEnded() {
      setTimeout(() => {
        document.getElementById('minigame-overlay').classList.remove('show');
        beerParticipants = [];
      }, 10000);
    }

    // ÊØîÂ§ßÂ∞è
    function handlePokerStarted(data) {
      const overlay = document.getElementById('minigame-overlay');
      overlay.innerHTML = `
        <div class="minigame-content">
          <div class="minigame-icon">üÉè</div>
          <div class="minigame-title">Êí≤ÂÖãÁâåÊØîÂ§ßÂ∞è</div>
          <div class="poker-betting">Áé©ÂÆ∂‰∏ãÊ≥®‰∏≠...</div>
          <div class="poker-timer" id="poker-timer-display">20s</div>
          <div style="font-size: 1.2rem; color: var(--text-muted);">
            7~K = Â§ß | A~6 = Â∞è
          </div>
        </div>
      `;
      overlay.classList.add('show');

      // ÂÄíË®àÊôÇ
      const endTime = data.endTime;
      const updateTimer = setInterval(() => {
        const remaining = Math.max(0, Math.ceil((endTime - Date.now()) / 1000));
        const timerEl = document.getElementById('poker-timer-display');
        if (timerEl) {
          timerEl.textContent = remaining + 's';
        }
        if (remaining <= 0) {
          clearInterval(updateTimer);
        }
      }, 100);
    }

    function handlePokerEnded(data) {
      const cardNames = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
      const cardDisplay = cardNames[data.card - 1] || data.card;
      const resultText = data.result === 'big' ? 'Â§ß' : 'Â∞è';
      const resultClass = data.result;

      const overlay = document.getElementById('minigame-overlay');
      overlay.innerHTML = `
        <div class="minigame-content">
          <div class="minigame-title">üÉè Êí≤ÂÖãÁâåÊØîÂ§ßÂ∞è</div>
          <div class="poker-card-display">${cardDisplay}</div>
          <div class="poker-result ${resultClass}">ÁµêÊûúÔºö${resultText}</div>
          <div class="poker-winners-losers">
            <div class="poker-list">
              <div class="poker-list-title winners">üéâ Áç≤ÂãùÔºà+100ÂàÜÔºâ</div>
              <div class="poker-list-items">
                ${data.winners.length > 0 ?
                  data.winners.map(w => w.playerName).join('<br>') :
                  '<span style="color: var(--text-muted);">ÁÑ°</span>'
                }
              </div>
            </div>
            <div class="poker-list">
              <div class="poker-list-title losers">üòÖ Ëº∏‰∫ÜÔºàÂñùÈÖíÔºâ</div>
              <div class="poker-list-items">
                ${data.losers.length > 0 ?
                  data.losers.map(l => l.playerName).join('<br>') :
                  '<span style="color: var(--text-muted);">ÁÑ°</span>'
                }
              </div>
            </div>
          </div>
        </div>
      `;

      setTimeout(() => {
        overlay.classList.remove('show');
      }, 10000);
    }

    // ========== ÊäΩÁçéÁ≥ªÁµ± ==========
    let lotteryPlayers = [];       // ÂèØÊäΩÁçéÁöÑÁé©ÂÆ∂ÂàóË°®
    let lotteryWinners = [];       // Â∑≤‰∏≠ÁçéÁöÑÁé©ÂÆ∂
    let isSpinning = false;        // ÊòØÂê¶Ê≠£Âú®ËΩâÂãï
    let spinInterval = null;       // ËΩâÂãïË®àÊôÇÂô®
    let currentPrizeIndex = 1;     // ÁõÆÂâçÁçéÈ†ÖÁ∑®Ëôü

    // ÈñãÂßãÊäΩÁçéÊ®°Âºè
    function startLotteryMode(players) {
      lotteryPlayers = players.filter(p => !lotteryWinners.some(w => w.id === p.id));
      if (lotteryPlayers.length === 0) {
        alert('Ê≤íÊúâÂèØÊäΩÁçéÁöÑÁé©ÂÆ∂‰∫ÜÔºÅ');
        return;
      }

      document.getElementById('lottery-overlay').classList.add('show');
      document.getElementById('lottery-prize-label').textContent = `Á¨¨ ${currentPrizeIndex} ‰ΩçÂπ∏ÈÅãÂÖí`;
      document.getElementById('lottery-hint').textContent = 'Á≠âÂæÖ‰∏ªÊåÅ‰∫∫ÈªûÊìäÊäΩÁçé...';
      document.getElementById('lottery-winner-display').innerHTML = '';

      // Âª∫Á´ãÂêçÂ≠óËªåÈÅì
      buildNamesTrack();
      updateWinnersList();
    }

    // Âª∫Á´ãÂêçÂ≠óËªåÈÅìÔºàÈáçË§áÂ§öÊ¨°‰ª•Áî¢ÁîüÁÑ°ÈôêÊªæÂãïÊïàÊûúÔºâ
    function buildNamesTrack() {
      const track = document.getElementById('lottery-names-track');
      const repeatCount = 10; // ÈáçË§áÊ¨°Êï∏
      let html = '';

      for (let i = 0; i < repeatCount; i++) {
        lotteryPlayers.forEach(player => {
          html += `
            <div class="lottery-name-item" data-id="${player.id}">
              <div class="name">${player.name}</div>
              <div class="score">${player.score} ÂàÜ</div>
            </div>
          `;
        });
      }

      track.innerHTML = html;
      track.style.transform = 'translateX(0)';
      track.classList.remove('stopping');
    }

    // ÈñãÂßãËΩâÂãï
    function startSpin() {
      if (isSpinning || lotteryPlayers.length === 0) return;

      isSpinning = true;
      document.getElementById('lottery-hint').textContent = 'ÊäΩÁçé‰∏≠...';
      document.getElementById('lottery-winner-display').innerHTML = '';

      const track = document.getElementById('lottery-names-track');
      track.classList.remove('stopping');

      // ÁßªÈô§‰πãÂâçÁöÑ winner Ê®ôË®ò
      track.querySelectorAll('.lottery-name-item').forEach(item => {
        item.classList.remove('winner');
      });

      let position = 0;
      const speed = 30; // ÈÄüÂ∫¶ÔºàÊØèÂπÄÁßªÂãïÁöÑÂÉèÁ¥†Ôºâ
      const itemWidth = 220; // ÊØèÂÄãÈ†ÖÁõÆÂØ¨Â∫¶Ôºà200px + 20px marginÔºâ

      spinInterval = setInterval(() => {
        position -= speed;
        track.style.transform = `translateX(${position}px)`;

        // ÁÑ°ÈôêÂæ™Áí∞
        const totalWidth = lotteryPlayers.length * itemWidth;
        if (Math.abs(position) >= totalWidth * 3) {
          position += totalWidth;
        }
      }, 16);
    }

    // ÂÅúÊ≠¢ËΩâÂãïÔºàÈÅ∏‰∏≠Ë¥èÂÆ∂Ôºâ
    function stopSpin() {
      if (!isSpinning) return;

      clearInterval(spinInterval);

      // Èö®Ê©üÈÅ∏Êìá‰∏ÄÂÄãË¥èÂÆ∂ÔºàÂèØ‰ª•Âä†ÂÖ•Ê¨äÈáçÔºâ
      const winnerIndex = Math.floor(Math.random() * lotteryPlayers.length);
      const winner = lotteryPlayers[winnerIndex];

      const track = document.getElementById('lottery-names-track');
      const itemWidth = 220;
      const containerCenter = 300; // ÂÆπÂô®ÂØ¨Â∫¶ÁöÑ‰∏ÄÂçä

      // Ë®àÁÆóÂÅúÊ≠¢‰ΩçÁΩÆÔºàËÆìË¥èÂÆ∂Âú®‰∏≠ÈñìÔºâ
      // ÊâæÂà∞Á¨¨5ÁµÑÁöÑË¥èÂÆ∂‰ΩçÁΩÆ
      const targetPosition = -(winnerIndex * itemWidth + lotteryPlayers.length * 4 * itemWidth) + containerCenter - itemWidth / 2;

      track.classList.add('stopping');
      track.style.transform = `translateX(${targetPosition}px)`;

      // Á≠âÂæÖÂãïÁï´ÂÆåÊàê
      setTimeout(() => {
        isSpinning = false;

        // Ê®ôË®òË¥èÂÆ∂
        const winnerItems = track.querySelectorAll(`[data-id="${winner.id}"]`);
        winnerItems.forEach(item => item.classList.add('winner'));

        // È°ØÁ§∫Ë¥èÂÆ∂
        showWinner(winner);

        // Ê∑ªÂä†Âà∞Â∑≤‰∏≠ÁçéÂàóË°®
        lotteryWinners.push({
          ...winner,
          prizeIndex: currentPrizeIndex
        });

        // ÂæûÂèØÊäΩÁçéÂàóË°®ÁßªÈô§
        lotteryPlayers = lotteryPlayers.filter(p => p.id !== winner.id);

        currentPrizeIndex++;
        updateWinnersList();

        // ÊîæÂΩ©Â∏∂
        launchConfetti();

        // Êõ¥Êñ∞ÊèêÁ§∫
        if (lotteryPlayers.length > 0) {
          document.getElementById('lottery-hint').textContent = 'ÈªûÊìäÁπºÁ∫åÊäΩ‰∏ã‰∏Ä‰Ωç...';
        } else {
          document.getElementById('lottery-hint').textContent = 'üéä ÊâÄÊúâÁçéÈ†ÖÂ∑≤ÊäΩÂÆåÔºÅ';
        }

        // ÁôºÈÄÅ‰∏≠ÁçéÁµêÊûúÂà∞‰º∫ÊúçÂô®
        socket.emit('lottery:winner', {
          winner: winner,
          prizeIndex: currentPrizeIndex - 1
        });
      }, 3000);
    }

    // È°ØÁ§∫Ë¥èÂÆ∂
    function showWinner(winner) {
      const display = document.getElementById('lottery-winner-display');
      display.innerHTML = `
        <div class="lottery-winner-name">üéâ ${winner.name} üéâ</div>
        <div class="lottery-winner-score">Á©çÂàÜÔºö${winner.score} ÂàÜ</div>
      `;
    }

    // Êõ¥Êñ∞Â∑≤‰∏≠ÁçéÂàóË°®
    function updateWinnersList() {
      const container = document.getElementById('lottery-winners-container');

      if (lotteryWinners.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.5); font-size: 0.9rem;">Â∞öÊú™ÊäΩÂá∫</p>';
        return;
      }

      container.innerHTML = lotteryWinners.map((winner, index) => {
        let rankClass = '';
        if (index === 0) rankClass = 'gold';
        else if (index === 1) rankClass = 'silver';
        else if (index === 2) rankClass = 'bronze';

        return `
          <div class="lottery-winner-item">
            <span class="rank ${rankClass}">${index + 1}</span>
            <span style="flex: 1; margin-left: 10px;">${winner.name}</span>
            <span style="color: #FFD93D;">${winner.score}</span>
          </div>
        `;
      }).join('');
    }

    // ÊîæÂΩ©Â∏∂ÊïàÊûú
    function launchConfetti() {
      const container = document.getElementById('lottery-confetti');
      const colors = ['#FFD93D', '#FF6B9D', '#4FC3F7', '#6BCB77', '#FF6B6B', '#C86BFA'];

      for (let i = 0; i < 100; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti-piece';
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animationDelay = Math.random() * 0.5 + 's';
        container.appendChild(confetti);

        setTimeout(() => confetti.classList.add('animate'), 10);

        // Ê∏ÖÁêÜ
        setTimeout(() => confetti.remove(), 3500);
      }
    }

    // ÈóúÈñâÊäΩÁçéÊ®°Âºè
    function closeLotteryMode() {
      document.getElementById('lottery-overlay').classList.remove('show');
    }

    // ÈáçÁΩÆÊäΩÁçé
    function resetLottery() {
      lotteryWinners = [];
      currentPrizeIndex = 1;
      isSpinning = false;
      if (spinInterval) clearInterval(spinInterval);
    }

    // ÊäΩÁçé‰∫ã‰ª∂Áõ£ËÅΩÂô®Â∑≤ÁßªËá≥ DOMContentLoaded ÂÖß

    // ========== Êñ∞ÁâàÈ†íÁçéÂÖ∏Á¶ÆÔºà‰æùÊéíÂêçÈ†ÜÂ∫èÔºâ ==========
    let awardPlayers = [];        // ÊâÄÊúâÁé©ÂÆ∂Ôºà‰æùÊéíÂêçÔºâ
    let awardWinners = [];        // Â∑≤È†íÁçéÁöÑÂæóÁçéËÄÖ
    let awardPrizeCount = 0;      // Á∏ΩÁçéÂìÅÊï∏
    let currentAwardRank = 0;     // ÁõÆÂâçÈ†íÂà∞Á¨¨ÂπæÂêç
    let isRevealing = false;      // ÊòØÂê¶Ê≠£Âú®Êè≠ÊõâÂãïÁï´‰∏≠

    // È†íÁçé‰∫ã‰ª∂Áõ£ËÅΩÂô®Â∑≤ÁßªËá≥ DOMContentLoaded ÂÖß

    // ÈñãÂßãÈ†íÁçéÂÖ∏Á¶Æ
    function startAwardMode() {
      // È°ØÁ§∫È†íÁçéÁï´Èù¢
      document.getElementById('lottery-overlay').classList.add('show');
      document.getElementById('lottery-prize-label').textContent = `üèÜ È†íÁçéÂÖ∏Á¶Æ - ÂÖ± ${awardPrizeCount} ‰ªΩÁçéÂìÅ`;
      document.getElementById('lottery-hint').textContent = 'Á≠âÂæÖ‰∏ªÊåÅ‰∫∫Êè≠ÊõâÂæóÁçéËÄÖ...';
      document.getElementById('lottery-winner-display').innerHTML = '';

      // Âª∫Á´ãÂêçÂ≠óËªåÈÅìÔºàÁî®ÊñºÂãïÁï´Ôºâ
      buildAwardTrack();
      updateAwardWinnersList();
    }

    // Êè≠ÊõâÂæóÁçéËÄÖ
    function revealWinner() {
      if (isRevealing || currentAwardRank >= awardPlayers.length) return;
      isRevealing = true;

      const winner = awardPlayers[currentAwardRank];
      const rank = currentAwardRank + 1;

      document.getElementById('lottery-hint').textContent = `Ê≠£Âú®Êè≠ÊõâÁ¨¨ ${rank} Âêç...`;

      // Êí≠ÊîæË∑ëÈ¶¨ÁáàÂãïÁï´ÔºåÁÑ∂ÂæåÂÅúÂú®ÂæóÁçéËÄÖ‰∏ä
      playRevealAnimation(winner, rank);
    }

    // ÈóúÈñâÈ†íÁçé
    function closeAwardMode() {
      document.getElementById('lottery-overlay').classList.remove('show');
      awardPlayers = [];
      awardWinners = [];
      currentAwardRank = 0;
    }

    // Âª∫Á´ãÈ†íÁçéÂêçÂ≠óËªåÈÅì
    function buildAwardTrack() {
      const track = document.getElementById('lottery-names-track');
      const repeatCount = 10;
      let html = '';

      for (let i = 0; i < repeatCount; i++) {
        awardPlayers.forEach((player, index) => {
          html += `
            <div class="lottery-name-item" data-id="${player.id}" data-rank="${index + 1}">
              <div class="name">${player.name}</div>
              <div class="score">${player.score} ÂàÜ</div>
            </div>
          `;
        });
      }

      track.innerHTML = html;
      track.style.transform = 'translateX(0)';
      track.classList.remove('stopping');
    }

    // Êí≠ÊîæÊè≠ÊõâÂãïÁï´
    function playRevealAnimation(winner, rank) {
      const track = document.getElementById('lottery-names-track');
      const itemWidth = 220;

      // ÁßªÈô§‰πãÂâçÁöÑ winner Ê®ôË®ò
      track.querySelectorAll('.lottery-name-item').forEach(item => {
        item.classList.remove('winner');
      });

      // ÂÖàÂø´ÈÄüÊªæÂãï
      let position = 0;
      const speed = 35;
      track.classList.remove('stopping');

      const spinDuration = 2000 + Math.random() * 1000; // 2-3ÁßíÊªæÂãï
      const startTime = Date.now();

      const animate = () => {
        const elapsed = Date.now() - startTime;

        if (elapsed < spinDuration) {
          position -= speed;
          track.style.transform = `translateX(${position}px)`;

          // ÁÑ°ÈôêÂæ™Áí∞
          const totalWidth = awardPlayers.length * itemWidth;
          if (Math.abs(position) >= totalWidth * 3) {
            position += totalWidth;
          }

          requestAnimationFrame(animate);
        } else {
          // ÂÅúÊ≠¢‰∏¶ÂÆö‰ΩçÂà∞ÂæóÁçéËÄÖ
          const winnerIndex = awardPlayers.findIndex(p => p.id === winner.id);
          const containerCenter = 300;
          const targetPosition = -(winnerIndex * itemWidth + awardPlayers.length * 4 * itemWidth) + containerCenter - itemWidth / 2;

          track.classList.add('stopping');
          track.style.transform = `translateX(${targetPosition}px)`;

          // Á≠âÂæÖÂãïÁï´ÂÆåÊàê
          setTimeout(() => {
            // Ê®ôË®òÂæóÁçéËÄÖ
            const winnerItems = track.querySelectorAll(`[data-id="${winner.id}"]`);
            winnerItems.forEach(item => item.classList.add('winner'));

            // È°ØÁ§∫ÂæóÁçéËÄÖË≥áË®ä
            showAwardWinner(winner, rank);

            // Ê∑ªÂä†Âà∞Â∑≤ÂæóÁçéÂàóË°®
            awardWinners.push({ ...winner, rank });
            updateAwardWinnersList();

            // ÊîæÂΩ©Â∏∂
            launchConfetti();

            // Êõ¥Êñ∞ÊèêÁ§∫
            if (currentAwardRank < awardPrizeCount) {
              document.getElementById('lottery-hint').textContent = 'Á≠âÂæÖÊè≠Êõâ‰∏ã‰∏Ä‰ΩçÂæóÁçéËÄÖ...';
            } else {
              document.getElementById('lottery-hint').textContent = 'üéä È†íÁçéÂÖ∏Á¶ÆÂúìÊªøÁµêÊùüÔºÅ';
            }

            isRevealing = false;
          }, 3000);
        }
      };

      requestAnimationFrame(animate);
    }

    // È°ØÁ§∫ÂæóÁçéËÄÖ
    function showAwardWinner(winner, rank) {
      const display = document.getElementById('lottery-winner-display');
      let rankEmoji = 'üéñÔ∏è';
      if (rank === 1) rankEmoji = 'ü•á';
      else if (rank === 2) rankEmoji = 'ü•à';
      else if (rank === 3) rankEmoji = 'ü•â';

      display.innerHTML = `
        <div class="lottery-winner-name">${rankEmoji} Á¨¨ ${rank} Âêç ${rankEmoji}</div>
        <div class="lottery-winner-name" style="font-size: 3rem; margin-top: 10px;">${winner.name}</div>
        <div class="lottery-winner-score">Á©çÂàÜÔºö${winner.score} ÂàÜ</div>
      `;
    }

    // Êõ¥Êñ∞Â∑≤ÂæóÁçéÂàóË°®
    function updateAwardWinnersList() {
      const container = document.getElementById('lottery-winners-container');

      if (awardWinners.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.5); font-size: 0.9rem;">Á≠âÂæÖÊè≠Êõâ...</p>';
        return;
      }

      container.innerHTML = awardWinners.map((winner) => {
        let rankClass = '';
        if (winner.rank === 1) rankClass = 'gold';
        else if (winner.rank === 2) rankClass = 'silver';
        else if (winner.rank === 3) rankClass = 'bronze';

        return `
          <div class="lottery-winner-item">
            <span class="rank ${rankClass}">${winner.rank}</span>
            <span style="flex: 1; margin-left: 10px;">${winner.name}</span>
            <span style="color: #FFD93D;">${winner.score}</span>
          </div>
        `;
      }).join('');
    }
  </script>
</body>
</html>
