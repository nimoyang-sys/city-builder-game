<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å‰µæ™ºå‹•èƒ½ 2026 - åŸå¸‚å»ºè¨­</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');

    :root {
      /* å¡é€šå¯æ„›é¢¨é…è‰² */
      --primary: #FF6B9D;
      --secondary: #FFD93D;
      --success: #6BCB77;
      --info: #4D96FF;
      --danger: #FF6B6B;
      --purple: #C86BFA;
      --bg-sky: #87CEEB;
      --bg-card: rgba(255,255,255,0.95);
      --text: #4A4A4A;
      --text-light: #FFFFFF;
      --ground: #8BC34A;
      --ground-dark: #689F38;
      --shadow: rgba(0,0,0,0.15);
    }

    body {
      font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif;
      background: linear-gradient(180deg, #4FC3F7 0%, #81D4FA 30%, #B3E5FC 50%, #E1F5FE 70%);
      color: var(--text);
      min-height: 100vh;
      overflow: hidden;
    }

    .display-container {
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ===== é ‚éƒ¨æ¨™é¡Œåˆ— - é€æ˜ç„¡èƒŒæ™¯ ===== */
    .top-bar {
      background: transparent;
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 10;
      position: relative;
    }

    .game-title {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo {
      width: 60px;
      height: auto;
      filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
    }

    .title-text h1 {
      font-size: 1.8rem;
      font-weight: 900;
      color: #333;
      letter-spacing: 2px;
      text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
    }

    .title-text .slogan {
      font-size: 0.9rem;
      color: #555;
      font-weight: 600;
      margin-top: 2px;
      text-shadow: 1px 1px 1px rgba(255,255,255,0.8);
    }

    .stats-bar {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .stat-item {
      text-align: center;
      background: rgba(255, 255, 255, 0.9);
      padding: 8px 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border: 2px solid #e0e0e0;
    }

    .stat-value {
      font-size: 1.8rem;
      font-weight: 900;
      color: #333;
    }

    .stat-label {
      font-size: 0.75rem;
      color: #888;
      margin-top: 2px;
      font-weight: 500;
    }

    .status-badge {
      padding: 10px 20px;
      font-size: 1rem;
      font-weight: 700;
      border-radius: 25px;
      border: none;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }

    .status-badge.building {
      background: #4CAF50;
      color: #fff;
    }
    .status-badge.event {
      background: #FF9800;
      color: #fff;
    }
    .status-badge.waiting {
      background: #2196F3;
      color: #fff;
    }
    .status-badge.ended {
      background: #E91E63;
      color: #fff;
    }

    /* ===== ä¸»è¦åŸå¸‚å€åŸŸ ===== */
    .city-area {
      flex: 1;
      position: relative;
      overflow: hidden;
    }

    /* å¤©ç©ºèƒŒæ™¯ - å¯æ„›è—å¤© */
    .sky {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 60%;
      /* ç§»é™¤èƒŒæ™¯ï¼Œä½¿ç”¨ body çš„æ¼¸å±¤èƒŒæ™¯ï¼Œé¿å…åˆ†ç•Œç·š */
      background: transparent;
    }

    /* éš±è—æ˜Ÿæ˜Ÿï¼ˆç™½å¤©ä¸éœ€è¦ï¼‰*/
    .stars {
      display: none;
    }

    /* å¯æ„›å¤ªé™½ */
    .sun {
      position: absolute;
      top: 8%;
      right: 10%;
      width: 120px;
      height: 120px;
      background: radial-gradient(circle, #FFF9C4 0%, #FFD93D 50%, #FFC107 100%);
      border-radius: 50%;
      box-shadow:
        0 0 60px rgba(255,217,61,0.6),
        0 0 100px rgba(255,193,7,0.4);
      animation: sunHappy 3s ease-in-out infinite;
    }

    /* å¤ªé™½è¡¨æƒ… */
    .sun::before {
      content: 'â—¡â€¿â—¡';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2rem;
      color: #FF9800;
    }

    @keyframes sunHappy {
      0%, 100% {
        transform: scale(1) rotate(0deg);
        box-shadow: 0 0 60px rgba(255,217,61,0.6), 0 0 100px rgba(255,193,7,0.4);
      }
      50% {
        transform: scale(1.05) rotate(5deg);
        box-shadow: 0 0 80px rgba(255,217,61,0.7), 0 0 120px rgba(255,193,7,0.5);
      }
    }

    /* å¯æ„›é›²æœµ */
    .clouds {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 250px;
      overflow: hidden;
    }

    .cloud {
      position: absolute;
      background: white;
      border-radius: 50px;
      opacity: 0.95;
      animation: cloudFloat 50s linear infinite;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }

    .cloud::before, .cloud::after {
      content: '';
      position: absolute;
      background: white;
      border-radius: 50%;
    }

    .cloud-1 {
      width: 120px;
      height: 50px;
      top: 50px;
      left: -150px;
      animation-duration: 45s;
    }
    .cloud-1::before { width: 60px; height: 60px; top: -30px; left: 20px; }
    .cloud-1::after { width: 45px; height: 45px; top: -20px; left: 65px; }

    .cloud-2 {
      width: 150px;
      height: 60px;
      top: 100px;
      left: -200px;
      animation-duration: 55s;
      animation-delay: -20s;
    }
    .cloud-2::before { width: 70px; height: 70px; top: -35px; left: 30px; }
    .cloud-2::after { width: 55px; height: 55px; top: -25px; left: 85px; }

    .cloud-3 {
      width: 100px;
      height: 45px;
      top: 160px;
      left: -130px;
      animation-duration: 60s;
      animation-delay: -35s;
    }
    .cloud-3::before { width: 50px; height: 50px; top: -25px; left: 15px; }
    .cloud-3::after { width: 40px; height: 40px; top: -18px; left: 55px; }

    @keyframes cloudFloat {
      from { transform: translateX(0); }
      to { transform: translateX(calc(100vw + 250px)); }
    }

    /* åœ°é¢ - å¯æ„›è‰åœ° */
    .ground-area {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 38%;
      background: linear-gradient(180deg,
        #8BC34A 0%,
        #7CB342 30%,
        #689F38 60%,
        #558B2F 100%
      );
      border-top: 6px solid #9CCC65;
    }

    /* è‰åœ°è£é£¾ - å°èŠ± */
    .ground-area::before {
      content: 'ğŸŒ¸ ğŸŒ¼ ğŸŒ¸ ğŸŒ¼ ğŸŒ¸ ğŸŒ¼ ğŸŒ¸ ğŸŒ¼ ğŸŒ¸ ğŸŒ¼ ğŸŒ¸ ğŸŒ¼ ğŸŒ¸ ğŸŒ¼ ğŸŒ¸ ğŸŒ¼ ğŸŒ¸ ğŸŒ¼ ğŸŒ¸ ğŸŒ¼';
      position: absolute;
      top: -5px;
      left: 0;
      right: 0;
      font-size: 1.2rem;
      letter-spacing: 30px;
      opacity: 0.8;
      animation: flowerSway 4s ease-in-out infinite;
    }

    @keyframes flowerSway {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-3px); }
    }

    /* é“è·¯ - å¯æ„›é¢¨æ ¼ */
    .road {
      position: absolute;
      bottom: 50px;
      left: 0;
      right: 0;
      height: 55px;
      background: linear-gradient(180deg, #78909C 0%, #607D8B 50%, #546E7A 100%);
      border-top: 5px solid #90A4AE;
      border-bottom: 5px solid #455A64;
      border-radius: 0;
    }

    .road::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 8px;
      background: repeating-linear-gradient(90deg,
        #FFFFFF 0px, #FFFFFF 50px,
        transparent 50px, transparent 100px
      );
      transform: translateY(-50%);
      border-radius: 4px;
    }

    /* äººè¡Œé“ - å¯æ„›ç£šå¡Š */
    .sidewalk {
      position: absolute;
      bottom: 105px;
      left: 0;
      right: 0;
      height: 30px;
      background: linear-gradient(180deg, #FFCCBC 0%, #FFAB91 100%);
      border-top: 4px solid #FFE0B2;
      border-bottom: 4px solid #FF8A65;
    }

    .sidewalk::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: repeating-linear-gradient(90deg,
        transparent 0px, transparent 38px,
        rgba(255,255,255,0.3) 38px, rgba(255,255,255,0.3) 40px
      );
    }

    /* å»ºç¯‰ç‰©å€åŸŸ - å¤šå±¤ç”±è¿‘è€Œé  */
    .buildings-container {
      position: absolute;
      bottom: 135px;
      left: 20px;
      right: 340px;
      top: 200px;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      pointer-events: none;
      overflow: hidden;
    }

    /* å»ºç¯‰æ’ */
    .building-row {
      display: flex;
      align-items: flex-end;
      justify-content: center;
      gap: 6px;
      padding: 0 10px;
      flex-wrap: wrap;
      position: relative;
    }

    /* å¾Œæ’ï¼ˆé è™•ï¼‰- æœ€å° */
    .building-row.row-back {
      transform: scale(0.5);
      transform-origin: bottom center;
      filter: brightness(0.75) saturate(0.75);
      z-index: 1;
      margin-bottom: -40px;
    }

    /* ä¸­æ’ */
    .building-row.row-mid {
      transform: scale(0.72);
      transform-origin: bottom center;
      filter: brightness(0.88) saturate(0.88);
      z-index: 2;
      margin-bottom: -20px;
    }

    /* å‰æ’ï¼ˆè¿‘è™•ï¼‰- æœ€å¤§ */
    .building-row.row-front {
      transform: scale(1);
      z-index: 3;
    }

    /* å–®å€‹å»ºç¯‰ */
    .building {
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: buildPop 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      cursor: default;
      pointer-events: auto;
    }

    /* ç©å®¶åç¨±æ¨™ç±¤ */
    .building-owner {
      margin-top: 4px;
      padding: 2px 8px;
      background: rgba(255,255,255,0.9);
      border-radius: 10px;
      font-size: 0.7rem;
      font-weight: 600;
      color: #5D4037;
      white-space: nowrap;
      max-width: 70px;
      overflow: hidden;
      text-overflow: ellipsis;
      box-shadow: 0 2px 4px rgba(0,0,0,0.15);
      border: 2px solid #FFB6C1;
    }

    @keyframes buildPop {
      0% {
        transform: scale(0) translateY(30px);
        opacity: 0;
      }
      60% {
        transform: scale(1.1) translateY(-10px);
      }
      100% {
        transform: scale(1) translateY(0);
        opacity: 1;
      }
    }

    /* å·²å­˜åœ¨çš„å»ºç¯‰ä¸è¦å‹•ç•« */
    .building.no-animation {
      animation: none;
    }

    .building:hover .css-building {
      transform: scale(1.1) translateY(-5px);
    }

    /* ===== CSS å¡é€šå»ºç¯‰ - å›ºå®šå°ºå¯¸ä¸è®Šå½¢ ===== */
    .css-building {
      position: relative;
      transition: transform 0.3s ease;
      filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.2));
    }

    .building:hover .css-building {
      transform: scale(1.1) translateY(-5px);
    }

    /* å‰æ’å»ºç¯‰å°ºå¯¸ */
    .building-row.row-front .css-building {
      transform: scale(1);
    }

    /* ä¸­æ’å»ºç¯‰å°ºå¯¸ */
    .building-row.row-mid .css-building {
      transform: scale(0.85);
    }

    /* å¾Œæ’å»ºç¯‰å°ºå¯¸ */
    .building-row.row-back .css-building {
      transform: scale(0.7);
    }

    /* === ä½å®… HOUSE === */
    .b-house {
      width: 50px;
      height: 55px;
    }
    .b-house .body {
      position: absolute;
      bottom: 0;
      left: 5px;
      width: 40px;
      height: 35px;
      background: linear-gradient(135deg, #FFCDD2 0%, #EF9A9A 100%);
      border-radius: 4px;
    }
    .b-house .roof {
      position: absolute;
      top: 0;
      left: 0;
      width: 0;
      height: 0;
      border-left: 25px solid transparent;
      border-right: 25px solid transparent;
      border-bottom: 25px solid #E57373;
    }
    .b-house .door {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 12px;
      height: 18px;
      background: #8D6E63;
      border-radius: 2px 2px 0 0;
    }
    .b-house .window {
      position: absolute;
      top: 25px;
      width: 10px;
      height: 10px;
      background: #81D4FA;
      border: 2px solid #fff;
      border-radius: 2px;
    }
    .b-house .window.left { left: 10px; }
    .b-house .window.right { right: 10px; }

    /* === å…¬å¯“ APARTMENT === */
    .b-apartment {
      width: 45px;
      height: 70px;
    }
    .b-apartment .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 45px;
      height: 70px;
      background: linear-gradient(135deg, #90CAF9 0%, #64B5F6 100%);
      border-radius: 4px 4px 0 0;
    }
    .b-apartment .window-row {
      position: absolute;
      left: 5px;
      right: 5px;
      display: flex;
      justify-content: space-between;
    }
    .b-apartment .window-row:nth-child(2) { top: 8px; }
    .b-apartment .window-row:nth-child(3) { top: 24px; }
    .b-apartment .window-row:nth-child(4) { top: 40px; }
    .b-apartment .win {
      width: 12px;
      height: 12px;
      background: #FFF9C4;
      border-radius: 2px;
    }
    .b-apartment .door {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 14px;
      height: 16px;
      background: #5D4037;
      border-radius: 2px 2px 0 0;
    }

    /* === è±ªå®… MANSION === */
    .b-mansion {
      width: 65px;
      height: 65px;
    }
    .b-mansion .body {
      position: absolute;
      bottom: 0;
      left: 5px;
      width: 55px;
      height: 45px;
      background: linear-gradient(135deg, #CE93D8 0%, #BA68C8 100%);
      border-radius: 4px;
    }
    .b-mansion .roof {
      position: absolute;
      top: 5px;
      left: 0;
      width: 65px;
      height: 20px;
      background: #7B1FA2;
      clip-path: polygon(10% 100%, 0% 0%, 100% 0%, 90% 100%);
    }
    .b-mansion .tower {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 15px;
      height: 25px;
      background: #9C27B0;
      border-radius: 3px 3px 0 0;
    }
    .b-mansion .flag {
      position: absolute;
      top: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 6px solid #FFD93D;
      border-top: 4px solid transparent;
      border-bottom: 4px solid transparent;
    }

    /* === å•†åº— SHOP === */
    .b-shop {
      width: 50px;
      height: 50px;
    }
    .b-shop .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 50px;
      height: 40px;
      background: linear-gradient(135deg, #FFCC80 0%, #FFB74D 100%);
      border-radius: 4px 4px 0 0;
    }
    .b-shop .awning {
      position: absolute;
      top: 0;
      left: -3px;
      width: 56px;
      height: 15px;
      background: repeating-linear-gradient(90deg, #F44336 0px, #F44336 8px, #fff 8px, #fff 16px);
      border-radius: 0 0 8px 8px;
    }
    .b-shop .window-big {
      position: absolute;
      top: 18px;
      left: 5px;
      right: 5px;
      height: 18px;
      background: #E1F5FE;
      border: 2px solid #fff;
      border-radius: 2px;
    }

    /* === é¤å»³ RESTAURANT === */
    .b-restaurant {
      width: 55px;
      height: 55px;
    }
    .b-restaurant .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 55px;
      height: 45px;
      background: linear-gradient(135deg, #A5D6A7 0%, #81C784 100%);
      border-radius: 4px 4px 0 0;
    }
    .b-restaurant .sign {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 35px;
      height: 15px;
      background: #C62828;
      border-radius: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
    }
    .b-restaurant .window-big {
      position: absolute;
      top: 18px;
      left: 8px;
      right: 8px;
      height: 15px;
      background: #FFF8E1;
      border: 2px solid #fff;
      border-radius: 2px;
    }
    .b-restaurant .door {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 16px;
      height: 14px;
      background: #5D4037;
      border-radius: 2px 2px 0 0;
    }

    /* === é£¯åº— HOTEL === */
    .b-hotel {
      width: 55px;
      height: 80px;
    }
    .b-hotel .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 55px;
      height: 80px;
      background: linear-gradient(135deg, #FFAB91 0%, #FF8A65 100%);
      border-radius: 4px 4px 0 0;
    }
    .b-hotel .top {
      position: absolute;
      top: 0;
      left: 15px;
      width: 25px;
      height: 10px;
      background: #E64A19;
      border-radius: 3px 3px 0 0;
    }
    .b-hotel .h-sign {
      position: absolute;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 12px;
      background: #FFD93D;
      border-radius: 2px;
      font-size: 9px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #E64A19;
    }

    /* === ç™¾è²¨ MALL === */
    .b-mall {
      width: 70px;
      height: 70px;
    }
    .b-mall .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 70px;
      height: 60px;
      background: linear-gradient(135deg, #F8BBD9 0%, #F48FB1 100%);
      border-radius: 6px 6px 0 0;
    }
    .b-mall .roof-deco {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 15px;
      background: #E91E63;
      border-radius: 8px 8px 0 0;
    }
    .b-mall .windows {
      position: absolute;
      top: 20px;
      left: 5px;
      right: 5px;
      height: 35px;
      background: #E1F5FE;
      border: 3px solid #fff;
      border-radius: 3px;
    }

    /* === å·¥å»  FACTORY === */
    .b-factory {
      width: 65px;
      height: 60px;
    }
    .b-factory .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 50px;
      height: 45px;
      background: linear-gradient(135deg, #B0BEC5 0%, #90A4AE 100%);
      border-radius: 4px 4px 0 0;
    }
    .b-factory .chimney {
      position: absolute;
      bottom: 40px;
      right: 0;
      width: 15px;
      height: 30px;
      background: #78909C;
      border-radius: 2px 2px 0 0;
    }
    .b-factory .smoke {
      position: absolute;
      top: -15px;
      right: 2px;
      width: 12px;
      height: 12px;
      background: #ECEFF1;
      border-radius: 50%;
      animation: smokeFloat 2s ease-in-out infinite;
    }
    @keyframes smokeFloat {
      0%, 100% { transform: translateY(0) scale(1); opacity: 0.8; }
      50% { transform: translateY(-8px) scale(1.2); opacity: 0.4; }
    }

    /* === å€‰åº« WAREHOUSE === */
    .b-warehouse {
      width: 55px;
      height: 45px;
    }
    .b-warehouse .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 55px;
      height: 35px;
      background: linear-gradient(135deg, #BCAAA4 0%, #A1887F 100%);
      border-radius: 2px;
    }
    .b-warehouse .roof {
      position: absolute;
      top: 0;
      left: 0;
      width: 55px;
      height: 12px;
      background: #795548;
      clip-path: polygon(0% 100%, 5% 0%, 95% 0%, 100% 100%);
    }
    .b-warehouse .door-big {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 25px;
      height: 25px;
      background: #5D4037;
      border-radius: 2px 2px 0 0;
    }

    /* === ç§‘æŠ€åœ’å€ TECHPARK === */
    .b-techpark {
      width: 60px;
      height: 65px;
    }
    .b-techpark .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 60px;
      height: 55px;
      background: linear-gradient(135deg, #B2EBF2 0%, #80DEEA 100%);
      border-radius: 8px 8px 0 0;
    }
    .b-techpark .glass {
      position: absolute;
      top: 10px;
      left: 5px;
      right: 5px;
      bottom: 10px;
      background: linear-gradient(135deg, #E0F7FA 0%, #B2EBF2 100%);
      border-radius: 4px;
      border: 2px solid #4DD0E1;
    }
    .b-techpark .antenna {
      position: absolute;
      top: -10px;
      right: 15px;
      width: 4px;
      height: 15px;
      background: #00ACC1;
    }
    .b-techpark .antenna::after {
      content: '';
      position: absolute;
      top: -4px;
      left: -3px;
      width: 10px;
      height: 10px;
      background: #4DD0E1;
      border-radius: 50%;
      animation: blink 1.5s ease-in-out infinite;
    }
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    /* === å…¬åœ’ PARK === */
    .b-park {
      width: 55px;
      height: 55px;
    }
    .b-park .ground {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 55px;
      height: 15px;
      background: #A5D6A7;
      border-radius: 8px;
    }
    .b-park .tree {
      position: absolute;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
    }
    .b-park .trunk {
      width: 8px;
      height: 15px;
      background: #8D6E63;
      margin: 0 auto;
      border-radius: 2px;
    }
    .b-park .leaves {
      width: 35px;
      height: 35px;
      background: radial-gradient(circle, #81C784 0%, #66BB6A 50%, #4CAF50 100%);
      border-radius: 50%;
      margin-bottom: -5px;
    }
    .b-park .flower {
      position: absolute;
      bottom: 10px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
    .b-park .flower.f1 { left: 5px; background: #FF80AB; }
    .b-park .flower.f2 { right: 5px; background: #FFD54F; }

    /* === å­¸æ ¡ SCHOOL === */
    .b-school {
      width: 65px;
      height: 55px;
    }
    .b-school .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 65px;
      height: 45px;
      background: linear-gradient(135deg, #FFF59D 0%, #FFF176 100%);
      border-radius: 4px 4px 0 0;
    }
    .b-school .roof {
      position: absolute;
      top: 0;
      left: 0;
      width: 65px;
      height: 12px;
      background: #FBC02D;
      border-radius: 4px 4px 0 0;
    }
    .b-school .clock {
      position: absolute;
      top: 14px;
      left: 50%;
      transform: translateX(-50%);
      width: 14px;
      height: 14px;
      background: #fff;
      border-radius: 50%;
      border: 2px solid #F57F17;
    }
    .b-school .windows-row {
      position: absolute;
      top: 32px;
      left: 5px;
      right: 5px;
      display: flex;
      justify-content: space-between;
    }
    .b-school .win {
      width: 14px;
      height: 12px;
      background: #E3F2FD;
      border: 2px solid #fff;
      border-radius: 2px;
    }

    /* === é†«é™¢ HOSPITAL === */
    .b-hospital {
      width: 55px;
      height: 70px;
    }
    .b-hospital .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 55px;
      height: 70px;
      background: linear-gradient(135deg, #FFFFFF 0%, #F5F5F5 100%);
      border-radius: 4px 4px 0 0;
      border: 2px solid #E0E0E0;
    }
    .b-hospital .cross {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 18px;
      height: 18px;
      background: #EF5350;
      clip-path: polygon(35% 0%, 65% 0%, 65% 35%, 100% 35%, 100% 65%, 65% 65%, 65% 100%, 35% 100%, 35% 65%, 0% 65%, 0% 35%, 35% 35%);
    }
    .b-hospital .entrance {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 20px;
      background: #90CAF9;
      border-radius: 4px 4px 0 0;
    }

    /* === é«”è‚²å ´ STADIUM === */
    .b-stadium {
      width: 75px;
      height: 50px;
    }
    .b-stadium .body {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 75px;
      height: 35px;
      background: linear-gradient(135deg, #E1BEE7 0%, #CE93D8 100%);
      border-radius: 50% 50% 4px 4px;
    }
    .b-stadium .field {
      position: absolute;
      bottom: 5px;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 18px;
      background: #81C784;
      border-radius: 4px;
      border: 2px solid #fff;
    }
    .b-stadium .lights {
      position: absolute;
      top: 0;
      width: 6px;
      height: 20px;
      background: #9E9E9E;
    }
    .b-stadium .lights.l1 { left: 10px; }
    .b-stadium .lights.l2 { right: 10px; }
    .b-stadium .light-top {
      position: absolute;
      top: -5px;
      left: -2px;
      width: 10px;
      height: 8px;
      background: #FFEB3B;
      border-radius: 2px;
    }

    /* === åœ°æ¨™ LANDMARK === */
    .b-landmark {
      width: 45px;
      height: 85px;
    }
    .b-landmark .base {
      position: absolute;
      bottom: 0;
      left: 5px;
      width: 35px;
      height: 25px;
      background: linear-gradient(135deg, #FFCCBC 0%, #FFAB91 100%);
      border-radius: 4px;
    }
    .b-landmark .tower {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 50px;
      background: linear-gradient(135deg, #FF8A65 0%, #FF7043 100%);
      border-radius: 2px;
    }
    .b-landmark .top {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 12px solid transparent;
      border-right: 12px solid transparent;
      border-bottom: 18px solid #E64A19;
    }
    .b-landmark .antenna {
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 3px;
      height: 12px;
      background: #BF360C;
    }

    /* === å¤ªç©ºç«™ SPACEPORT === */
    .b-spaceport {
      width: 60px;
      height: 80px;
    }
    .b-spaceport .base {
      position: absolute;
      bottom: 0;
      left: 5px;
      width: 50px;
      height: 20px;
      background: linear-gradient(135deg, #B0BEC5 0%, #90A4AE 100%);
      border-radius: 4px;
    }
    .b-spaceport .rocket {
      position: absolute;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 50px;
      background: linear-gradient(135deg, #E0E0E0 0%, #BDBDBD 100%);
      border-radius: 10px 10px 0 0;
    }
    .b-spaceport .rocket-top {
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-bottom: 15px solid #EF5350;
    }
    .b-spaceport .fin {
      position: absolute;
      bottom: 0;
      width: 0;
      height: 0;
      border-top: 12px solid transparent;
      border-bottom: 0 solid transparent;
    }
    .b-spaceport .fin.left {
      left: -8px;
      border-right: 10px solid #78909C;
    }
    .b-spaceport .fin.right {
      right: -8px;
      border-left: 10px solid #78909C;
    }
    .b-spaceport .window {
      position: absolute;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      width: 10px;
      height: 10px;
      background: #4FC3F7;
      border-radius: 50%;
      border: 2px solid #0288D1;
    }
    .b-spaceport .flame {
      position: absolute;
      bottom: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 12px;
      height: 20px;
      background: linear-gradient(180deg, #FF9800 0%, #FF5722 50%, transparent 100%);
      border-radius: 0 0 6px 6px;
      animation: flameFlicker 0.3s ease-in-out infinite alternate;
    }
    @keyframes flameFlicker {
      0% { transform: translateX(-50%) scaleY(1); }
      100% { transform: translateX(-50%) scaleY(0.8); }
    }


    /* æ’è¡Œæ¦œå´é‚Šæ¬„ - å¡é€šå¯æ„›é¢¨æ ¼ */
    .side-panel {
      position: absolute;
      top: 100px;
      right: 20px;
      width: 320px;
      background: var(--bg-card);
      border-radius: 25px;
      border: 4px solid #FFD93D;
      box-shadow: 0 8px 30px rgba(255,107,157,0.2), inset 0 2px 0 rgba(255,255,255,0.8);
      padding: 20px;
      max-height: calc(100vh - 200px);
      overflow-y: auto;
    }

    .panel-title {
      font-size: 1.3rem;
      font-weight: 900;
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      gap: 12px;
      color: #FF6B9D;
      border-bottom: 3px dashed #FFB6C1;
      padding-bottom: 12px;
    }

    .leaderboard-item {
      display: flex;
      align-items: center;
      padding: 12px 15px;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #FFF5F8 0%, #FFE4EC 100%);
      border-radius: 15px;
      border: 3px solid #FFB6C1;
      transition: all 0.3s ease;
    }

    .leaderboard-item:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 5px 15px rgba(255,107,157,0.3);
    }

    .leaderboard-item:nth-child(1) {
      background: linear-gradient(135deg, #FFF8E1 0%, #FFECB3 100%);
      border-color: #FFD54F;
      box-shadow: 0 4px 15px rgba(255,213,79,0.3);
    }

    .leaderboard-item:nth-child(2) {
      background: linear-gradient(135deg, #F5F5F5 0%, #E0E0E0 100%);
      border-color: #BDBDBD;
    }

    .leaderboard-item:nth-child(3) {
      background: linear-gradient(135deg, #FFCCBC 0%, #FFAB91 100%);
      border-color: #FF8A65;
    }

    .rank {
      font-size: 1.4rem;
      font-weight: 900;
      width: 40px;
      text-align: center;
    }

    .rank-1 { color: #FFC107; text-shadow: 1px 1px 0 #FF8F00; }
    .rank-2 { color: #9E9E9E; text-shadow: 1px 1px 0 #616161; }
    .rank-3 { color: #FF8A65; text-shadow: 1px 1px 0 #E64A19; }

    .player-info {
      flex: 1;
      margin-left: 12px;
    }

    .player-name {
      font-size: 1.1rem;
      font-weight: 700;
      color: #5D4037;
    }

    .player-buildings {
      font-size: 0.85rem;
      color: #8D6E63;
      margin-top: 3px;
    }

    .player-score {
      font-size: 1.3rem;
      font-weight: 900;
      color: #FF6B9D;
      text-shadow: 1px 1px 0 rgba(255,107,157,0.3);
    }

    /* äº‹ä»¶å…¬å‘Š - å¡é€šå¯æ„›é¢¨æ ¼ */
    .event-panel {
      position: absolute;
      top: 100px;
      left: 20px;
      width: 400px;
      background: var(--bg-card);
      border-radius: 25px;
      border: 4px solid #FFD93D;
      box-shadow: 0 8px 30px rgba(255,107,157,0.2), inset 0 2px 0 rgba(255,255,255,0.8);
      padding: 22px;
      display: none;
    }

    .event-panel.show {
      display: block;
      animation: eventPopIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes eventPopIn {
      0% { transform: scale(0.5) rotate(-10deg); opacity: 0; }
      60% { transform: scale(1.1) rotate(3deg); }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }

    .event-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 15px;
      border-bottom: 3px dashed #FFB6C1;
      padding-bottom: 15px;
    }

    .event-icon {
      font-size: 3rem;
      filter: drop-shadow(2px 3px 0 rgba(0,0,0,0.15));
      animation: eventIconWiggle 1s ease-in-out infinite;
    }

    @keyframes eventIconWiggle {
      0%, 100% { transform: rotate(-5deg); }
      50% { transform: rotate(5deg); }
    }

    .event-title {
      font-size: 1.4rem;
      font-weight: 900;
      color: #FF6B9D;
    }

    .event-type {
      font-size: 0.95rem;
      color: #8D6E63;
      font-weight: 500;
    }

    .event-description {
      font-size: 1.1rem;
      margin-bottom: 15px;
      line-height: 1.6;
      color: #5D4037;
    }

    .event-effects {
      background: linear-gradient(135deg, #FFF5F8 0%, #FFE4EC 100%);
      border-radius: 15px;
      padding: 15px;
      border: 2px solid #FFB6C1;
    }

    .effect-title {
      font-size: 0.9rem;
      color: #8D6E63;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .effect-text {
      font-size: 1.1rem;
      font-weight: 700;
    }

    .effect-text.positive { color: #4CAF50; }
    .effect-text.negative { color: #EF5350; }

    /* å»ºç¯‰çµ±è¨ˆæ¬„ - å¡é€šå¯æ„›é¢¨æ ¼ */
    .stats-panel {
      position: absolute;
      bottom: 15px;
      left: 20px;
      right: 360px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .category-badge {
      background: var(--bg-card);
      border-radius: 20px;
      border: 3px solid #4FC3F7;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 10px 18px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      font-weight: 500;
      color: #5D4037;
    }

    .category-badge:hover {
      transform: translateY(-4px) scale(1.05);
      box-shadow: 0 8px 20px rgba(79,195,247,0.3);
      border-color: #29B6F6;
    }

    .category-badge .emoji {
      font-size: 1.5rem;
    }

    .category-badge .count {
      font-weight: 900;
      color: #FF6B9D;
      font-size: 1.2rem;
    }

    /* ===== ç­‰å¾…ç•«é¢ - å¡é€šå¯æ„›é¢¨æ ¼ ===== */
    .waiting-overlay {
      position: fixed;
      inset: 0;
      background: linear-gradient(180deg,
        #87CEEB 0%,
        #B4E7FF 30%,
        #E8F8FF 60%,
        #FFF5F8 100%
      );
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
      padding: 20px;
      overflow: hidden;
    }

    .waiting-content-wrapper {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 60px;
      max-width: 1400px;
      width: 100%;
      height: 100%;
      position: relative;
      z-index: 1;
    }

    .waiting-left-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .waiting-right-section {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ç­‰å¾…ç•«é¢è£é£¾ - é£„å‹•çš„æ„›å¿ƒå’Œæ˜Ÿæ˜Ÿ */
    .waiting-overlay::before {
      content: 'â¤ï¸ â­ ğŸ’– âœ¨ ğŸ’• ğŸŒŸ ğŸ’— â­ â¤ï¸ âœ¨ ğŸ’– ğŸŒŸ';
      position: absolute;
      top: 50px;
      left: 0;
      right: 0;
      font-size: 2rem;
      text-align: center;
      letter-spacing: 40px;
      animation: floatDecor 4s ease-in-out infinite;
      opacity: 0.6;
    }

    .waiting-overlay::after {
      content: 'ğŸ  ğŸ¢ ğŸª ğŸ­ ğŸ« ğŸ¥ ğŸŸï¸ ğŸ—¼ ğŸš€';
      position: absolute;
      bottom: 80px;
      left: 0;
      right: 0;
      font-size: 2.5rem;
      text-align: center;
      letter-spacing: 30px;
      animation: floatBuildings 3s ease-in-out infinite;
    }

    @keyframes floatDecor {
      0%, 100% { transform: translateY(0) rotate(-2deg); }
      50% { transform: translateY(-15px) rotate(2deg); }
    }

    @keyframes floatBuildings {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }

    .waiting-overlay.hidden {
      display: none;
    }

    .waiting-logo {
      font-size: 6rem;
      margin-bottom: 20px;
      filter: drop-shadow(4px 6px 0 rgba(255,107,157,0.4));
      animation: logoHop 0.8s ease-in-out infinite;
      position: relative;
      z-index: 1;
    }

    @keyframes logoHop {
      0%, 100% { transform: translateY(0) scale(1) rotate(-3deg); }
      50% { transform: translateY(-25px) scale(1.05) rotate(3deg); }
    }

    .waiting-logo-img {
      max-width: 300px;
      width: 100%;
      height: auto;
      margin-bottom: 15px;
      filter: drop-shadow(4px 6px 0 rgba(255,107,157,0.2));
      position: relative;
      z-index: 1;
    }

    .waiting-title {
      font-size: 3rem;
      font-weight: 900;
      color: #FF6B9D;
      text-shadow: 3px 3px 0 #fff, 6px 6px 0 rgba(255,107,157,0.3);
      margin-bottom: 15px;
      position: relative;
      z-index: 1;
      letter-spacing: 5px;
    }

    .waiting-subtitle {
      font-size: 1.3rem;
      color: #8B5A8B;
      margin-bottom: 25px;
      position: relative;
      z-index: 1;
      font-weight: 600;
      text-align: center;
    }

    .waiting-players {
      font-size: 1.2rem;
      color: #5D4037;
      position: relative;
      z-index: 1;
      background: var(--bg-card);
      padding: 25px 50px;
      border-radius: 25px;
      border: 4px solid #FFD93D;
      box-shadow: 0 8px 30px rgba(255,107,157,0.2);
      font-weight: 500;
      text-align: center;
    }

    .waiting-players span {
      color: #FF6B9D;
      font-weight: 900;
      font-size: 2.5rem;
    }

    .qr-hint {
      padding: 30px 60px;
      background: var(--bg-card);
      border-radius: 30px;
      border: 4px solid #4FC3F7;
      box-shadow: 0 8px 30px rgba(79,195,247,0.2);
      text-align: center;
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 500px;
    }

    .qr-hint p {
      color: #5D4037;
      margin-bottom: 18px;
      font-size: 1.1rem;
      font-weight: 500;
    }

    .qr-url {
      font-size: 1.4rem;
      font-weight: 900;
      color: #4FC3F7;
    }

    /* ===== çµæŸç•«é¢ - å¡é€šå¯æ„›é¢¨æ ¼ ===== */
    .end-overlay {
      position: fixed;
      inset: 0;
      background: linear-gradient(180deg,
        #FFE4EC 0%,
        #FFF5F8 30%,
        #E8F8FF 60%,
        #E1F5FE 100%
      );
      display: none;
      flex-direction: column;
      padding: 40px;
      z-index: 100;
    }

    .end-overlay.show {
      display: flex;
    }

    .end-title {
      font-size: 3.5rem;
      font-weight: 900;
      text-align: center;
      margin-bottom: 30px;
      color: #FF6B9D;
      text-shadow: 3px 3px 0 #fff, 6px 6px 0 rgba(255,107,157,0.3);
      animation: celebrateBounce 1s ease-in-out infinite;
    }

    @keyframes celebrateBounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.03); }
    }

    .end-content {
      flex: 1;
      display: flex;
      gap: 30px;
    }

    .final-city {
      flex: 2;
      background: var(--bg-card);
      border-radius: 30px;
      border: 4px solid #FFD93D;
      padding: 30px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 30px rgba(255,107,157,0.15);
    }

    .final-city-ground {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 100px;
      background: linear-gradient(180deg, #8BC34A 0%, #689F38 100%);
      border-radius: 0 0 26px 26px;
    }

    .final-buildings {
      position: absolute;
      bottom: 100px;
      left: 20px;
      right: 20px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .final-leaderboard {
      flex: 1;
      background: var(--bg-card);
      border-radius: 30px;
      border: 4px solid #4FC3F7;
      padding: 30px;
      overflow-y: auto;
      box-shadow: 0 8px 30px rgba(79,195,247,0.15);
    }

    /* ===== çµæŸç•«é¢å½±ç‰‡èˆ‡æ–‡æ¡ˆå€åŸŸ ===== */
    .end-video-section {
      margin-top: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 40px;
      background: linear-gradient(135deg, rgba(255,107,157,0.1) 0%, rgba(79,195,247,0.1) 100%);
      border-radius: 30px;
      padding: 30px;
      border: 3px solid rgba(255,215,61,0.5);
    }

    .end-video-container {
      flex: 1;
      max-width: 500px;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 8px 30px rgba(0,0,0,0.2);
      border: 4px solid #FFD93D;
    }

    .end-video-container video {
      width: 100%;
      height: auto;
      display: block;
    }

    .end-slogan {
      flex: 1;
      text-align: center;
      padding: 20px;
    }

    .end-slogan p {
      font-size: 1.8rem;
      font-weight: 700;
      color: #5D4037;
      margin: 15px 0;
      text-shadow: 2px 2px 0 #fff;
    }

    .end-slogan .highlight {
      font-size: 2.2rem;
      font-weight: 900;
      color: #FF6B9D;
      background: linear-gradient(90deg, #FF6B9D, #4FC3F7);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: shimmer 2s ease-in-out infinite;
    }

    @keyframes shimmer {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.9; transform: scale(1.02); }
    }

    .final-leaderboard h2 {
      margin-bottom: 20px;
      color: #FF6B9D;
      font-weight: 900;
      font-size: 1.5rem;
    }

    /* ===== æŠ½çç•«é¢ ===== */
    .lottery-overlay {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 200;
    }

    .lottery-overlay.show {
      display: flex;
    }

    .lottery-title {
      font-size: 3rem;
      font-weight: 900;
      color: #FFD93D;
      text-shadow: 0 0 20px rgba(255,217,61,0.5), 3px 3px 0 rgba(0,0,0,0.3);
      margin-bottom: 20px;
      animation: lotteryTitlePulse 2s ease-in-out infinite;
    }

    @keyframes lotteryTitlePulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }

    .lottery-prize-label {
      font-size: 1.5rem;
      color: #4FC3F7;
      margin-bottom: 30px;
    }

    .lottery-spinner {
      width: 600px;
      height: 200px;
      background: rgba(255,255,255,0.1);
      border-radius: 20px;
      border: 4px solid #FFD93D;
      overflow: hidden;
      position: relative;
      box-shadow: 0 0 50px rgba(255,217,61,0.3), inset 0 0 30px rgba(0,0,0,0.5);
    }

    .lottery-spinner::before,
    .lottery-spinner::after {
      content: '';
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100px;
      z-index: 10;
      pointer-events: none;
    }

    .lottery-spinner::before {
      left: 0;
      background: linear-gradient(90deg, rgba(26,26,46,1) 0%, rgba(26,26,46,0) 100%);
    }

    .lottery-spinner::after {
      right: 0;
      background: linear-gradient(90deg, rgba(26,26,46,0) 0%, rgba(26,26,46,1) 100%);
    }

    .lottery-names-track {
      display: flex;
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      transition: transform 0.1s linear;
    }

    .lottery-names-track.stopping {
      transition: transform 3s cubic-bezier(0.1, 0.7, 0.1, 1);
    }

    .lottery-name-item {
      flex-shrink: 0;
      width: 200px;
      height: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 0 10px;
      background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.05) 100%);
      border-radius: 15px;
      border: 2px solid rgba(255,255,255,0.2);
      color: white;
    }

    .lottery-name-item.winner {
      background: linear-gradient(135deg, #FFD93D 0%, #FFC107 100%);
      border-color: #FF9800;
      color: #1a1a2e;
      transform: scale(1.1);
      box-shadow: 0 0 30px rgba(255,217,61,0.8);
    }

    .lottery-name-item .name {
      font-size: 1.8rem;
      font-weight: 900;
    }

    .lottery-name-item .score {
      font-size: 1rem;
      opacity: 0.8;
      margin-top: 5px;
    }

    .lottery-pointer {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-top: 30px solid #FF6B9D;
      filter: drop-shadow(0 3px 5px rgba(0,0,0,0.3));
      z-index: 20;
    }

    .lottery-pointer-bottom {
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-bottom: 30px solid #FF6B9D;
      filter: drop-shadow(0 -3px 5px rgba(0,0,0,0.3));
      z-index: 20;
    }

    .lottery-winner-display {
      margin-top: 40px;
      text-align: center;
      min-height: 150px;
    }

    .lottery-winner-name {
      font-size: 4rem;
      font-weight: 900;
      color: #FFD93D;
      text-shadow: 0 0 30px rgba(255,217,61,0.8);
      animation: winnerCelebrate 0.5s ease-in-out infinite alternate;
    }

    @keyframes winnerCelebrate {
      0% { transform: scale(1); }
      100% { transform: scale(1.05); }
    }

    .lottery-winner-score {
      font-size: 1.5rem;
      color: #4FC3F7;
      margin-top: 10px;
    }

    .lottery-hint {
      margin-top: 30px;
      font-size: 1.2rem;
      color: rgba(255,255,255,0.6);
    }

    .lottery-winners-list {
      position: absolute;
      right: 40px;
      top: 50%;
      transform: translateY(-50%);
      width: 280px;
      max-height: 70vh;
      background: rgba(0,0,0,0.4);
      border-radius: 20px;
      padding: 20px;
      overflow-y: auto;
    }

    .lottery-winners-list h3 {
      color: #FFD93D;
      font-size: 1.2rem;
      margin-bottom: 15px;
      text-align: center;
    }

    .lottery-winner-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      margin-bottom: 8px;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      color: white;
    }

    .lottery-winner-item .rank {
      width: 30px;
      height: 30px;
      background: #FF6B9D;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 0.9rem;
    }

    .lottery-winner-item .rank.gold { background: #FFD93D; color: #1a1a2e; }
    .lottery-winner-item .rank.silver { background: #C0C0C0; color: #1a1a2e; }
    .lottery-winner-item .rank.bronze { background: #CD7F32; color: white; }

    .lottery-confetti {
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
    }

    .confetti-piece {
      position: absolute;
      width: 10px;
      height: 20px;
      opacity: 0;
    }

    .confetti-piece.animate {
      animation: confettiFall 3s ease-out forwards;
    }

    @keyframes confettiFall {
      0% {
        opacity: 1;
        transform: translateY(-100px) rotate(0deg);
      }
      100% {
        opacity: 0;
        transform: translateY(100vh) rotate(720deg);
      }
    }
  </style>
</head>
<body>
  <div class="display-container">
    <!-- é ‚éƒ¨æ¨™é¡Œåˆ— -->
    <div class="top-bar">
      <div class="game-title">
        <img src="https://firebasestorage.googleapis.com/v0/b/christmas-tree-3fe6b.firebasestorage.app/o/logo%2F%E8%B3%87%E7%94%A2%208.png?alt=media&token=7519dfc2-7df3-4dd7-bb82-000c27ed3f67" alt="Logo" class="logo">
        <div class="title-text">
          <h1>å‰µæ™ºå‹•èƒ½ 2026</h1>
          <p class="slogan">âœ¨ çœ¾å¿—æˆåŸãƒ»ç¯‰å¤¢æˆçœŸ âœ¨</p>
        </div>
      </div>

      <div class="stats-bar">
        <div class="stat-item">
          <div class="stat-value" id="total-buildings">0</div>
          <div class="stat-label">å»ºç¯‰ç¸½æ•¸</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="total-players">0</div>
          <div class="stat-label">åƒèˆ‡äººæ•¸</div>
        </div>
      </div>

      <div class="status-badge waiting" id="status-badge">ç­‰å¾…ä¸­</div>
    </div>

    <!-- åŸå¸‚å€åŸŸ -->
    <div class="city-area">
      <!-- å¤©ç©º -->
      <div class="sky"></div>
      <div class="stars"></div>

      <!-- å¤ªé™½ -->
      <div class="sun"></div>

      <!-- é›²æœµ -->
      <div class="clouds">
        <div class="cloud cloud-1"></div>
        <div class="cloud cloud-2"></div>
        <div class="cloud cloud-3"></div>
      </div>

      <!-- åœ°é¢ -->
      <div class="ground-area"></div>

      <!-- äººè¡Œé“ -->
      <div class="sidewalk"></div>

      <!-- é“è·¯ -->
      <div class="road"></div>

      <!-- å»ºç¯‰ç‰© -->
      <div class="buildings-container" id="buildings-container">
        <!-- å‹•æ…‹ç”Ÿæˆå»ºç¯‰ -->
      </div>

      <!-- äº‹ä»¶å…¬å‘Š -->
      <div class="event-panel" id="event-panel" onclick="hideEvent()" style="cursor: pointer;">
        <div class="event-header">
          <span class="event-icon" id="event-icon">ğŸ“¢</span>
          <div>
            <div class="event-type" id="event-type">äº‹ä»¶</div>
            <div class="event-title" id="event-title">--</div>
          </div>
        </div>
        <div class="event-description" id="event-description">--</div>
        <div class="event-effects">
          <div class="effect-title">ç‡Ÿæ”¶åŠ æˆï¼ˆé‡‘å¹£ï¼‹è²¢ç»åˆ†ï¼‰</div>
          <div class="effect-text" id="event-effects">--</div>
        </div>
        <div style="margin-top: 10px; font-size: 0.8rem; color: rgba(255,255,255,0.6);">é»æ“Šé—œé–‰</div>
      </div>

      <!-- æ’è¡Œæ¦œ -->
      <div class="side-panel">
        <div class="panel-title">ğŸ† è²¢ç»æ’è¡Œæ¦œ</div>
        <div id="leaderboard">
          <!-- å‹•æ…‹ç”Ÿæˆ -->
        </div>
      </div>

      <!-- å»ºç¯‰çµ±è¨ˆ -->
      <div class="stats-panel" id="stats-panel">
        <!-- å‹•æ…‹ç”Ÿæˆ -->
      </div>
    </div>
  </div>

  <!-- ç­‰å¾…ç•«é¢ -->
  <div class="waiting-overlay" id="waiting-overlay">
    <div class="waiting-content-wrapper">
      <!-- å·¦å´ï¼šLogo + å‰¯æ¨™é¡Œ -->
      <div class="waiting-left-section">
        <div class="waiting-logo">ğŸ—ï¸</div>
        <img src="https://firebasestorage.googleapis.com/v0/b/christmas-tree-3fe6b.firebasestorage.app/o/logo%2F%E8%B3%87%E7%94%A2%2081.png?alt=media&token=46ed0dd8-94a3-414a-8e07-b253908e08ec"
             alt="å‰µæ™ºå‹•èƒ½ Logo"
             class="waiting-logo-img">
        <div class="waiting-subtitle">âœ¨ çœ¾å¿—æˆåŸãƒ»ç¯‰å¤¢æˆçœŸ âœ¨</div>
        <div class="waiting-players">
          ç›®å‰ <span id="waiting-player-count">0</span> ä½å¤¥ä¼´å·²å°±ä½
        </div>
      </div>

      <!-- å³å´ï¼šQR Code -->
      <div class="waiting-right-section">
        <div class="qr-hint">
          <p>æƒæ QR Code æˆ–è¼¸å…¥ç¶²å€åŠ å…¥éŠæˆ²</p>
          <div id="qr-code" style="margin: 20px auto; background: white; padding: 15px; border-radius: 8px; width: fit-content;"></div>
          <div class="qr-url" id="game-url">--</div>
        </div>
      </div>
    </div>
  </div>

  <!-- æŠ½çç•«é¢ -->
  <div class="lottery-overlay" id="lottery-overlay">
    <div class="lottery-confetti" id="lottery-confetti"></div>
    <div class="lottery-title">ğŸ° å¹¸é‹å¤§æŠ½ç ğŸ°</div>
    <div class="lottery-prize-label" id="lottery-prize-label">æº–å‚™æŠ½å‡ºå¹¸é‹å…’...</div>

    <div class="lottery-spinner">
      <div class="lottery-pointer"></div>
      <div class="lottery-pointer-bottom"></div>
      <div class="lottery-names-track" id="lottery-names-track">
        <!-- å‹•æ…‹ç”Ÿæˆåå­— -->
      </div>
    </div>

    <div class="lottery-winner-display" id="lottery-winner-display">
      <!-- ä¸­çè€…é¡¯ç¤º -->
    </div>

    <div class="lottery-hint" id="lottery-hint">ç­‰å¾…ä¸»æŒäººé–‹å§‹æŠ½ç...</div>

    <div class="lottery-winners-list" id="lottery-winners-list">
      <h3>ğŸ† å·²æŠ½å‡ºå¾—çè€…</h3>
      <div id="lottery-winners-container">
        <p style="text-align: center; color: rgba(255,255,255,0.5); font-size: 0.9rem;">å°šæœªæŠ½å‡º</p>
      </div>
    </div>
  </div>

  <!-- çµæŸç•«é¢ -->
  <div class="end-overlay" id="end-overlay">
    <div class="end-title">ğŸ‰ å‰µæ™ºåŸ å»ºè¨­å®Œæˆï¼ğŸ‰</div>
    <div class="end-content">
      <div class="final-city">
        <h2 style="margin-bottom: 20px; color: white;">ğŸ™ï¸ å‰µæ™ºåŸ æœ€çµ‚é¢¨è²Œ</h2>
        <div class="final-buildings" id="final-buildings"></div>
        <div class="final-city-ground"></div>
      </div>
      <div class="final-leaderboard">
        <h2 style="color: white;">ğŸ† æœ€çµ‚æ’è¡Œæ¦œ</h2>
        <div id="final-leaderboard"></div>
      </div>
    </div>
    <!-- å½±ç‰‡èˆ‡æ–‡æ¡ˆå€åŸŸ -->
    <div class="end-video-section">
      <div class="end-video-container">
        <video id="end-video" autoplay loop muted playsinline>
          <source src="https://firebasestorage.googleapis.com/v0/b/christmas-tree-3fe6b.firebasestorage.app/o/VIDEO%2Fgrok-video-b0490a7f-5814-4ead-b9d8-f9aa65d51e30%20(1).mp4?alt=media&token=e954da8d-33cc-4bd6-9f1b-ceddb604ab24" type="video/mp4">
        </video>
      </div>
      <div class="end-slogan">
        <p>ğŸŒŸ æœªä¾†ï¼Œå¤§å®¶å„è‡ªæ‰®æ¼”ä¸åŒè§’è‰²ç™¼æ®æ‰€é•·</p>
        <p class="highlight">2026 é½Šå¿ƒå”åŠ›ï¼Œå‰µé€ å‰µæ™ºäºå¤ªä¼æ¥­ç‰ˆåœ–ï¼</p>
      </div>
    </div>
  </div>

  <!-- QR Code Library -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    // éŠæˆ²è¨­å®š
    let gameConfig = null;
    let socket = null;

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', async () => {
      // å–å¾—è¨­å®š
      const configRes = await fetch('/api/config');
      gameConfig = await configRes.json();

      // è¨­å®šéŠæˆ²ç¶²å€ä¸¦ç”¢ç”Ÿ QR Code
      const url = window.location.origin;
      document.getElementById('game-url').textContent = url;

      // ç”¢ç”Ÿ QR Code
      QRCode.toCanvas(document.createElement('canvas'), url, {
        width: 200,
        margin: 0,
        color: {
          dark: '#FF6B9D',  // ç²‰ç´…è‰²ï¼Œç¬¦åˆ UI ä¸»é¡Œ
          light: '#ffffff'
        }
      }, function (error, canvas) {
        if (error) {
          console.error('QR Code generation failed:', error);
          return;
        }
        document.getElementById('qr-code').appendChild(canvas);
      });

      // é€£æ¥ Socket
      socket = io();

      socket.on('connect', () => {
        console.log('Display connected');
        fetchGameState();
      });

      // éŠæˆ²äº‹ä»¶
      socket.on('game:started', handleGameStarted);
      socket.on('game:buildingPhase', handleBuildingPhase);
      socket.on('game:buildingPurchased', handleBuildingPurchased);
      socket.on('game:buildingUpgraded', handleBuildingUpgraded);  // å»ºç¯‰å‡ç´šäº‹ä»¶
      socket.on('game:eventTriggered', handleEventTriggered);
      socket.on('game:scoreAdded', handleScoreAdded);
      socket.on('game:ended', handleGameEnded);
      socket.on('game:playerJoined', handlePlayerJoined);
      socket.on('game:reset', handleReset);
    });

    // å–å¾—éŠæˆ²ç‹€æ…‹
    async function fetchGameState() {
      const res = await fetch('/api/game/state');
      const state = await res.json();
      updateDisplay(state);
    }

    // æ›´æ–°ç•«é¢
    function updateDisplay(state) {
      // æ›´æ–°çµ±è¨ˆ
      document.getElementById('total-buildings').textContent = state.totalBuildings || 0;
      document.getElementById('total-players').textContent = state.playerCount || 0;
      document.getElementById('waiting-player-count').textContent = state.playerCount || 0;

      // æ›´æ–°ç‹€æ…‹æ¨™ç±¤
      updateStatusBadge(state.state);

      // æ›´æ–°å»ºç¯‰è¦–è¦ºåŒ–ï¼ˆä½¿ç”¨å»ºç¯‰åˆ—è¡¨ï¼‰
      renderCityBuildings(state.cityBuildings, state.cityBuildingList);

      // æ›´æ–°æ’è¡Œæ¦œ
      renderLeaderboard(state.leaderboard);

      // é¡¯ç¤º/éš±è—ç­‰å¾…ç•«é¢
      const waitingOverlay = document.getElementById('waiting-overlay');
      if (state.state === 'WAITING') {
        waitingOverlay.classList.remove('hidden');
      } else {
        waitingOverlay.classList.add('hidden');
      }

      // é¡¯ç¤ºäº‹ä»¶
      if (state.currentEvent && state.state === 'EVENT') {
        showEvent(state.currentEvent);
      }
    }

    // æ›´æ–°ç‹€æ…‹æ¨™ç±¤
    function updateStatusBadge(state) {
      const badge = document.getElementById('status-badge');
      const stateMap = {
        'WAITING': { text: 'ç­‰å¾…ä¸­', class: 'waiting' },
        'BUILDING': { text: 'å»ºè¨­ä¸­', class: 'building' },
        'EVENT': { text: 'äº‹ä»¶ç™¼ç”Ÿ', class: 'event' },
        'ENDED': { text: 'å·²çµæŸ', class: 'ended' }
      };
      const info = stateMap[state] || stateMap.WAITING;
      badge.textContent = info.text;
      badge.className = `status-badge ${info.class}`;
    }

    // CSS å»ºç¯‰æ¨¡æ¿
    function createCSSBuilding(buildingId) {
      switch(buildingId) {
        case 'HOUSE':
          return `<div class="css-building b-house">
            <div class="roof"></div>
            <div class="body">
              <div class="window left"></div>
              <div class="window right"></div>
              <div class="door"></div>
            </div>
          </div>`;
        case 'APARTMENT':
          return `<div class="css-building b-apartment">
            <div class="body">
              <div class="window-row"><div class="win"></div><div class="win"></div><div class="win"></div></div>
              <div class="window-row"><div class="win"></div><div class="win"></div><div class="win"></div></div>
              <div class="window-row"><div class="win"></div><div class="win"></div><div class="win"></div></div>
              <div class="door"></div>
            </div>
          </div>`;
        case 'MANSION':
          return `<div class="css-building b-mansion">
            <div class="tower"><div class="flag"></div></div>
            <div class="roof"></div>
            <div class="body"></div>
          </div>`;
        case 'SHOP':
          return `<div class="css-building b-shop">
            <div class="awning"></div>
            <div class="body">
              <div class="window-big"></div>
            </div>
          </div>`;
        case 'RESTAURANT':
          return `<div class="css-building b-restaurant">
            <div class="sign">ğŸœ</div>
            <div class="body">
              <div class="window-big"></div>
              <div class="door"></div>
            </div>
          </div>`;
        case 'HOTEL':
          return `<div class="css-building b-hotel">
            <div class="top"></div>
            <div class="body">
              <div class="h-sign">H</div>
            </div>
          </div>`;
        case 'MALL':
          return `<div class="css-building b-mall">
            <div class="roof-deco"></div>
            <div class="body">
              <div class="windows"></div>
            </div>
          </div>`;
        case 'FACTORY':
          return `<div class="css-building b-factory">
            <div class="chimney"><div class="smoke"></div></div>
            <div class="body"></div>
          </div>`;
        case 'WAREHOUSE':
          return `<div class="css-building b-warehouse">
            <div class="roof"></div>
            <div class="body">
              <div class="door-big"></div>
            </div>
          </div>`;
        case 'TECHPARK':
          return `<div class="css-building b-techpark">
            <div class="antenna"></div>
            <div class="body">
              <div class="glass"></div>
            </div>
          </div>`;
        case 'PARK':
          return `<div class="css-building b-park">
            <div class="tree">
              <div class="leaves"></div>
              <div class="trunk"></div>
            </div>
            <div class="ground"></div>
            <div class="flower f1"></div>
            <div class="flower f2"></div>
          </div>`;
        case 'SCHOOL':
          return `<div class="css-building b-school">
            <div class="roof"></div>
            <div class="body">
              <div class="clock"></div>
              <div class="windows-row">
                <div class="win"></div><div class="win"></div><div class="win"></div><div class="win"></div>
              </div>
            </div>
          </div>`;
        case 'HOSPITAL':
          return `<div class="css-building b-hospital">
            <div class="body">
              <div class="cross"></div>
              <div class="entrance"></div>
            </div>
          </div>`;
        case 'STADIUM':
          return `<div class="css-building b-stadium">
            <div class="lights l1"><div class="light-top"></div></div>
            <div class="lights l2"><div class="light-top"></div></div>
            <div class="body">
              <div class="field"></div>
            </div>
          </div>`;
        case 'LANDMARK':
          return `<div class="css-building b-landmark">
            <div class="antenna"></div>
            <div class="top"></div>
            <div class="tower"></div>
            <div class="base"></div>
          </div>`;
        case 'SPACEPORT':
          return `<div class="css-building b-spaceport">
            <div class="base"></div>
            <div class="rocket">
              <div class="rocket-top"></div>
              <div class="window"></div>
              <div class="fin left"></div>
              <div class="fin right"></div>
              <div class="flame"></div>
            </div>
          </div>`;
        default:
          return `<div class="css-building b-house">
            <div class="roof"></div>
            <div class="body"><div class="door"></div></div>
          </div>`;
      }
    }

    // è¿½è¹¤ç›®å‰å»ºç¯‰ç‹€æ…‹ï¼Œé¿å…é‡è¤‡æ¸²æŸ“å°è‡´é–ƒçˆ
    let currentBuildingKey = '';

    // æ¯æ’æœ€å¤šå¹¾æ£Ÿå»ºç¯‰
    const BUILDINGS_PER_ROW = 10;

    // æ¸²æŸ“åŸå¸‚å»ºç¯‰ï¼ˆä½¿ç”¨å»ºç¯‰åˆ—è¡¨ï¼Œå«ç©å®¶åç¨±ï¼‰
    function renderCityBuildings(cityBuildings, buildingList) {
      const container = document.getElementById('buildings-container');
      const statsPanel = document.getElementById('stats-panel');

      console.log('renderCityBuildings called:', { cityBuildings, buildingList });

      // åªä½¿ç”¨æœ‰ç©å®¶åç¨±çš„ buildingListï¼Œä¸å¾ stats é‡å»º
      // é€™æ¨£å¯ä»¥ç¢ºä¿æ¯æ£Ÿå»ºç¯‰éƒ½é¡¯ç¤ºæ­£ç¢ºçš„ç©å®¶åç¨±

      // å¦‚æœæ²’æœ‰å»ºç¯‰åˆ—è¡¨ï¼Œæ¸…ç©º
      if (!buildingList || buildingList.length === 0) {
        if (currentBuildingKey !== '') {
          container.innerHTML = '';
          currentBuildingKey = '';
        }
        statsPanel.innerHTML = '';
        return;
      }

      // å»ºç«‹å»ºç¯‰ key ä¾†æ¯”è¼ƒæ˜¯å¦æœ‰è®ŠåŒ–
      const newKey = buildingList.map(b => b.id).join(',');

      // åªæœ‰å»ºç¯‰æœ‰è®ŠåŒ–æ™‚æ‰é‡æ–°æ¸²æŸ“
      if (newKey !== currentBuildingKey) {
        const oldCount = currentBuildingKey ? currentBuildingKey.split(',').filter(x => x).length : 0;
        currentBuildingKey = newKey;

        // å°‡å»ºç¯‰åˆ†æˆå¤šæ’ï¼ˆç”±è¿‘è€Œé ï¼‰
        const rows = [];
        for (let i = 0; i < buildingList.length; i += BUILDINGS_PER_ROW) {
          rows.push(buildingList.slice(i, i + BUILDINGS_PER_ROW));
        }

        // æ¸²æŸ“å¤šæ’å»ºç¯‰
        let html = '';
        rows.forEach((rowBuildings, rowIndex) => {
          // æ±ºå®šå±¤æ¬¡ï¼šæœ€å¾Œæ’æ˜¯å‰æ’ï¼Œæœ€å‰æ’æ˜¯å¾Œæ’
          let rowClass = 'row-front';
          if (rows.length > 1) {
            const fromEnd = rows.length - 1 - rowIndex;
            if (fromEnd >= 2) rowClass = 'row-back';
            else if (fromEnd === 1) rowClass = 'row-mid';
            else rowClass = 'row-front';
          }

          html += `<div class="building-row ${rowClass}">`;
          rowBuildings.forEach((b, indexInRow) => {
            const globalIndex = rowIndex * BUILDINGS_PER_ROW + indexInRow;
            const isNew = globalIndex >= oldCount;
            // æˆªå–ç©å®¶åå­—ï¼ˆæœ€å¤š4å€‹å­—ï¼‰
            const shortName = b.playerName.length > 4 ? b.playerName.substring(0, 4) + '..' : b.playerName;
            html += `
              <div class="building ${isNew ? '' : 'no-animation'}" style="${isNew ? `animation-delay: ${(globalIndex - oldCount) * 0.08}s` : ''}" title="${b.playerName}">
                ${createCSSBuilding(b.buildingId)}
                <div class="building-owner">${shortName}</div>
              </div>
            `;
          });
          html += '</div>';
        });

        container.innerHTML = html;
      }

      // æ¸²æŸ“åˆ†é¡çµ±è¨ˆ
      statsPanel.innerHTML = '';
      if (cityBuildings && cityBuildings.categories) {
        for (const [catId, cat] of Object.entries(cityBuildings.categories)) {
          if (cat.count === 0) continue;

          const badge = document.createElement('div');
          badge.className = 'category-badge';
          badge.innerHTML = `
            <span class="emoji">${cat.emoji}</span>
            <span>${cat.name}</span>
            <span class="count">${cat.count}</span>
          `;
          statsPanel.appendChild(badge);
        }
      }
    }

    // æ¸²æŸ“æ’è¡Œæ¦œ
    function renderLeaderboard(leaderboard, targetId = 'leaderboard') {
      const list = document.getElementById(targetId);
      if (!leaderboard || leaderboard.length === 0) {
        list.innerHTML = '<p style="color: rgba(255,255,255,0.5); text-align: center; padding: 20px;">ç­‰å¾…ç©å®¶åŠ å…¥...</p>';
        return;
      }

      list.innerHTML = leaderboard.slice(0, 10).map((player, index) => `
        <div class="leaderboard-item">
          <div class="rank rank-${index + 1}">${index + 1}</div>
          <div class="player-info">
            <div class="player-name">${player.name}</div>
            <div class="player-buildings">${player.buildingCount || 0} æ£Ÿå»ºç¯‰</div>
          </div>
          <div class="player-score">${player.score}</div>
        </div>
      `).join('');
    }

    // äº‹ä»¶è‡ªå‹•éš±è—è¨ˆæ™‚å™¨
    let eventAutoHideTimer = null;

    // é¡¯ç¤ºäº‹ä»¶
    function showEvent(event) {
      const panel = document.getElementById('event-panel');
      const typeMap = {
        'BOOM': 'æ™¯æ°£ç¹æ¦®',
        'RECESSION': 'æ™¯æ°£è¡°é€€',
        'DISASTER': 'ç½é›£äº‹ä»¶',
        'POLICY': 'æ”¿ç­–åˆ©å¤š',
        'SPECIAL': 'ç‰¹æ®Šäº‹ä»¶'
      };

      document.getElementById('event-icon').textContent = event.emoji || 'ğŸ“¢';
      document.getElementById('event-type').textContent = typeMap[event.type] || 'äº‹ä»¶';
      document.getElementById('event-title').textContent = event.title;
      document.getElementById('event-description').textContent = event.description;

      const effectsEl = document.getElementById('event-effects');
      effectsEl.textContent = event.display?.affected || '--';
      effectsEl.className = `effect-text ${event.display?.mood || ''}`;

      panel.classList.add('show');

      // æ¸…é™¤èˆŠè¨ˆæ™‚å™¨ä¸¦è¨­å®šæ–°çš„è‡ªå‹•éš±è—ï¼ˆ8ç§’å¾Œï¼‰
      if (eventAutoHideTimer) {
        clearTimeout(eventAutoHideTimer);
      }
      eventAutoHideTimer = setTimeout(() => {
        hideEvent();
      }, 8000);
    }

    // éš±è—äº‹ä»¶
    function hideEvent() {
      document.getElementById('event-panel').classList.remove('show');
      if (eventAutoHideTimer) {
        clearTimeout(eventAutoHideTimer);
        eventAutoHideTimer = null;
      }
    }

    // äº‹ä»¶è™•ç†
    function handleGameStarted(data) {
      document.getElementById('waiting-overlay').classList.add('hidden');
      updateStatusBadge('BUILDING');
    }

    function handleBuildingPhase(data) {
      hideEvent();
      updateStatusBadge('BUILDING');
      // é‡æ–°å–å¾—å®Œæ•´ç‹€æ…‹ï¼ˆåŒ…å«å»ºç¯‰åˆ—è¡¨ï¼‰
      fetchGameState();
    }

    function handleBuildingPurchased(data) {
      // é‡æ–°æ¸²æŸ“å»ºç¯‰ï¼ˆä½¿ç”¨å»ºç¯‰åˆ—è¡¨ï¼‰
      renderCityBuildings(data.cityBuildings, data.cityBuildingList);

      // æ›´æ–°å»ºç¯‰ç¸½æ•¸
      const total = data.cityBuildingList ? data.cityBuildingList.length : 0;
      document.getElementById('total-buildings').textContent = total;
    }

    function handleBuildingUpgraded(data) {
      console.log('ğŸ—ï¸ Building upgraded:', data);

      // é‡æ–°æ¸²æŸ“å»ºç¯‰ï¼ˆä½¿ç”¨æ›´æ–°å¾Œçš„å»ºç¯‰åˆ—è¡¨ï¼‰
      renderCityBuildings(data.cityBuildings, data.cityBuildingList);

      // æ›´æ–°å»ºç¯‰ç¸½æ•¸
      const total = data.cityBuildingList ? data.cityBuildingList.length : 0;
      document.getElementById('total-buildings').textContent = total;

      // å¯é¸ï¼šé¡¯ç¤ºå‡ç´šé€šçŸ¥ï¼ˆç°¡å–®æç¤ºï¼‰
      console.log(`âœ¨ ${data.playerName} å‡ç´šäº† ${data.mergeCount} æ£Ÿ ${data.fromBuilding.name} â†’ ${data.toBuilding.name}ï¼`);
    }

    function handleEventTriggered(data) {
      updateStatusBadge('EVENT');
      showEvent(data.event);
      // é‡æ–°å–å¾—å®Œæ•´ç‹€æ…‹ï¼ˆåŒ…å«å»ºç¯‰åˆ—è¡¨ï¼‰
      fetchGameState();
      renderLeaderboard(data.leaderboard);
    }

    function handleScoreAdded(data) {
      fetchGameState();
    }

    function handleGameEnded(data) {
      updateStatusBadge('ENDED');

      // é¡¯ç¤ºçµæŸç•«é¢
      document.getElementById('end-overlay').classList.add('show');

      // æ¸²æŸ“æœ€çµ‚åŸå¸‚ï¼ˆä½¿ç”¨å»ºç¯‰åˆ—è¡¨ï¼Œå«ç©å®¶åç¨±ï¼‰
      const finalBuildings = document.getElementById('final-buildings');
      const buildingList = data.cityBuildingList || [];

      finalBuildings.innerHTML = buildingList.map(b => {
        const shortName = b.playerName.length > 4 ? b.playerName.substring(0, 4) + '..' : b.playerName;
        return `
          <div class="building no-animation" title="${b.playerName}" style="transform: scale(0.6);">
            ${createCSSBuilding(b.buildingId)}
            <div class="building-owner" style="font-size: 0.6rem;">${shortName}</div>
          </div>
        `;
      }).join('');

      // æ¸²æŸ“æœ€çµ‚æ’è¡Œæ¦œ
      renderLeaderboard(data.leaderboard, 'final-leaderboard');
    }

    function handlePlayerJoined(player) {
      fetchGameState();
    }

    function handleReset() {
      document.getElementById('end-overlay').classList.remove('show');
      document.getElementById('waiting-overlay').classList.remove('hidden');
      hideEvent();
      fetchGameState();
    }

    // å®šæœŸåˆ·æ–°
    setInterval(fetchGameState, 5000);

    // ========== æŠ½çç³»çµ± ==========
    let lotteryPlayers = [];       // å¯æŠ½ççš„ç©å®¶åˆ—è¡¨
    let lotteryWinners = [];       // å·²ä¸­ççš„ç©å®¶
    let isSpinning = false;        // æ˜¯å¦æ­£åœ¨è½‰å‹•
    let spinInterval = null;       // è½‰å‹•è¨ˆæ™‚å™¨
    let currentPrizeIndex = 1;     // ç›®å‰çé …ç·¨è™Ÿ

    // é–‹å§‹æŠ½çæ¨¡å¼
    function startLotteryMode(players) {
      lotteryPlayers = players.filter(p => !lotteryWinners.some(w => w.id === p.id));
      if (lotteryPlayers.length === 0) {
        alert('æ²’æœ‰å¯æŠ½ççš„ç©å®¶äº†ï¼');
        return;
      }

      document.getElementById('lottery-overlay').classList.add('show');
      document.getElementById('lottery-prize-label').textContent = `ç¬¬ ${currentPrizeIndex} ä½å¹¸é‹å…’`;
      document.getElementById('lottery-hint').textContent = 'ç­‰å¾…ä¸»æŒäººé»æ“ŠæŠ½ç...';
      document.getElementById('lottery-winner-display').innerHTML = '';

      // å»ºç«‹åå­—è»Œé“
      buildNamesTrack();
      updateWinnersList();
    }

    // å»ºç«‹åå­—è»Œé“ï¼ˆé‡è¤‡å¤šæ¬¡ä»¥ç”¢ç”Ÿç„¡é™æ»¾å‹•æ•ˆæœï¼‰
    function buildNamesTrack() {
      const track = document.getElementById('lottery-names-track');
      const repeatCount = 10; // é‡è¤‡æ¬¡æ•¸
      let html = '';

      for (let i = 0; i < repeatCount; i++) {
        lotteryPlayers.forEach(player => {
          html += `
            <div class="lottery-name-item" data-id="${player.id}">
              <div class="name">${player.name}</div>
              <div class="score">${player.score} åˆ†</div>
            </div>
          `;
        });
      }

      track.innerHTML = html;
      track.style.transform = 'translateX(0)';
      track.classList.remove('stopping');
    }

    // é–‹å§‹è½‰å‹•
    function startSpin() {
      if (isSpinning || lotteryPlayers.length === 0) return;

      isSpinning = true;
      document.getElementById('lottery-hint').textContent = 'æŠ½çä¸­...';
      document.getElementById('lottery-winner-display').innerHTML = '';

      const track = document.getElementById('lottery-names-track');
      track.classList.remove('stopping');

      // ç§»é™¤ä¹‹å‰çš„ winner æ¨™è¨˜
      track.querySelectorAll('.lottery-name-item').forEach(item => {
        item.classList.remove('winner');
      });

      let position = 0;
      const speed = 30; // é€Ÿåº¦ï¼ˆæ¯å¹€ç§»å‹•çš„åƒç´ ï¼‰
      const itemWidth = 220; // æ¯å€‹é …ç›®å¯¬åº¦ï¼ˆ200px + 20px marginï¼‰

      spinInterval = setInterval(() => {
        position -= speed;
        track.style.transform = `translateX(${position}px)`;

        // ç„¡é™å¾ªç’°
        const totalWidth = lotteryPlayers.length * itemWidth;
        if (Math.abs(position) >= totalWidth * 3) {
          position += totalWidth;
        }
      }, 16);
    }

    // åœæ­¢è½‰å‹•ï¼ˆé¸ä¸­è´å®¶ï¼‰
    function stopSpin() {
      if (!isSpinning) return;

      clearInterval(spinInterval);

      // éš¨æ©Ÿé¸æ“‡ä¸€å€‹è´å®¶ï¼ˆå¯ä»¥åŠ å…¥æ¬Šé‡ï¼‰
      const winnerIndex = Math.floor(Math.random() * lotteryPlayers.length);
      const winner = lotteryPlayers[winnerIndex];

      const track = document.getElementById('lottery-names-track');
      const itemWidth = 220;
      const containerCenter = 300; // å®¹å™¨å¯¬åº¦çš„ä¸€åŠ

      // è¨ˆç®—åœæ­¢ä½ç½®ï¼ˆè®“è´å®¶åœ¨ä¸­é–“ï¼‰
      // æ‰¾åˆ°ç¬¬5çµ„çš„è´å®¶ä½ç½®
      const targetPosition = -(winnerIndex * itemWidth + lotteryPlayers.length * 4 * itemWidth) + containerCenter - itemWidth / 2;

      track.classList.add('stopping');
      track.style.transform = `translateX(${targetPosition}px)`;

      // ç­‰å¾…å‹•ç•«å®Œæˆ
      setTimeout(() => {
        isSpinning = false;

        // æ¨™è¨˜è´å®¶
        const winnerItems = track.querySelectorAll(`[data-id="${winner.id}"]`);
        winnerItems.forEach(item => item.classList.add('winner'));

        // é¡¯ç¤ºè´å®¶
        showWinner(winner);

        // æ·»åŠ åˆ°å·²ä¸­çåˆ—è¡¨
        lotteryWinners.push({
          ...winner,
          prizeIndex: currentPrizeIndex
        });

        // å¾å¯æŠ½çåˆ—è¡¨ç§»é™¤
        lotteryPlayers = lotteryPlayers.filter(p => p.id !== winner.id);

        currentPrizeIndex++;
        updateWinnersList();

        // æ”¾å½©å¸¶
        launchConfetti();

        // æ›´æ–°æç¤º
        if (lotteryPlayers.length > 0) {
          document.getElementById('lottery-hint').textContent = 'é»æ“Šç¹¼çºŒæŠ½ä¸‹ä¸€ä½...';
        } else {
          document.getElementById('lottery-hint').textContent = 'ğŸŠ æ‰€æœ‰çé …å·²æŠ½å®Œï¼';
        }

        // ç™¼é€ä¸­ççµæœåˆ°ä¼ºæœå™¨
        socket.emit('lottery:winner', {
          winner: winner,
          prizeIndex: currentPrizeIndex - 1
        });
      }, 3000);
    }

    // é¡¯ç¤ºè´å®¶
    function showWinner(winner) {
      const display = document.getElementById('lottery-winner-display');
      display.innerHTML = `
        <div class="lottery-winner-name">ğŸ‰ ${winner.name} ğŸ‰</div>
        <div class="lottery-winner-score">ç©åˆ†ï¼š${winner.score} åˆ†</div>
      `;
    }

    // æ›´æ–°å·²ä¸­çåˆ—è¡¨
    function updateWinnersList() {
      const container = document.getElementById('lottery-winners-container');

      if (lotteryWinners.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.5); font-size: 0.9rem;">å°šæœªæŠ½å‡º</p>';
        return;
      }

      container.innerHTML = lotteryWinners.map((winner, index) => {
        let rankClass = '';
        if (index === 0) rankClass = 'gold';
        else if (index === 1) rankClass = 'silver';
        else if (index === 2) rankClass = 'bronze';

        return `
          <div class="lottery-winner-item">
            <span class="rank ${rankClass}">${index + 1}</span>
            <span style="flex: 1; margin-left: 10px;">${winner.name}</span>
            <span style="color: #FFD93D;">${winner.score}</span>
          </div>
        `;
      }).join('');
    }

    // æ”¾å½©å¸¶æ•ˆæœ
    function launchConfetti() {
      const container = document.getElementById('lottery-confetti');
      const colors = ['#FFD93D', '#FF6B9D', '#4FC3F7', '#6BCB77', '#FF6B6B', '#C86BFA'];

      for (let i = 0; i < 100; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti-piece';
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animationDelay = Math.random() * 0.5 + 's';
        container.appendChild(confetti);

        setTimeout(() => confetti.classList.add('animate'), 10);

        // æ¸…ç†
        setTimeout(() => confetti.remove(), 3500);
      }
    }

    // é—œé–‰æŠ½çæ¨¡å¼
    function closeLotteryMode() {
      document.getElementById('lottery-overlay').classList.remove('show');
    }

    // é‡ç½®æŠ½ç
    function resetLottery() {
      lotteryWinners = [];
      currentPrizeIndex = 1;
      isSpinning = false;
      if (spinInterval) clearInterval(spinInterval);
    }

    // ç›£è½æŠ½çäº‹ä»¶ï¼ˆå¾ä¸»æŒäººç«¯ï¼‰
    socket.on('lottery:start', (data) => {
      resetLottery();
      startLotteryMode(data.players);
    });

    socket.on('lottery:spin', () => {
      if (!isSpinning && lotteryPlayers.length > 0) {
        startSpin();
      }
    });

    socket.on('lottery:stop', () => {
      if (isSpinning) {
        stopSpin();
      }
    });

    socket.on('lottery:next', () => {
      if (!isSpinning && lotteryPlayers.length > 0) {
        document.getElementById('lottery-prize-label').textContent = `ç¬¬ ${currentPrizeIndex} ä½å¹¸é‹å…’`;
        document.getElementById('lottery-winner-display').innerHTML = '';
        buildNamesTrack();
      }
    });

    socket.on('lottery:close', () => {
      closeLotteryMode();
    });

    // ========== æ–°ç‰ˆé ’çå…¸ç¦®ï¼ˆä¾æ’åé †åºï¼‰ ==========
    let awardPlayers = [];        // æ‰€æœ‰ç©å®¶ï¼ˆä¾æ’åï¼‰
    let awardWinners = [];        // å·²é ’ççš„å¾—çè€…
    let awardPrizeCount = 0;      // ç¸½çå“æ•¸
    let currentAwardRank = 0;     // ç›®å‰é ’åˆ°ç¬¬å¹¾å
    let isRevealing = false;      // æ˜¯å¦æ­£åœ¨æ­æ›‰å‹•ç•«ä¸­

    // é–‹å§‹é ’çå…¸ç¦®
    socket.on('award:start', (data) => {
      console.log('Award ceremony started', data);
      awardPlayers = data.players;
      awardPrizeCount = data.prizeCount;
      awardWinners = [];
      currentAwardRank = 0;
      isRevealing = false;

      // é¡¯ç¤ºé ’çç•«é¢
      document.getElementById('lottery-overlay').classList.add('show');
      document.getElementById('lottery-prize-label').textContent = `ğŸ† é ’çå…¸ç¦® - å…± ${awardPrizeCount} ä»½çå“`;
      document.getElementById('lottery-hint').textContent = 'ç­‰å¾…ä¸»æŒäººæ­æ›‰å¾—çè€…...';
      document.getElementById('lottery-winner-display').innerHTML = '';

      // å»ºç«‹åå­—è»Œé“ï¼ˆç”¨æ–¼å‹•ç•«ï¼‰
      buildAwardTrack();
      updateAwardWinnersList();
    });

    // æ­æ›‰å¾—çè€…
    socket.on('award:reveal', (data) => {
      if (isRevealing) return;
      isRevealing = true;

      const { rank, winner } = data;
      currentAwardRank = rank;

      document.getElementById('lottery-hint').textContent = `æ­£åœ¨æ­æ›‰ç¬¬ ${rank} å...`;

      // æ’­æ”¾è·‘é¦¬ç‡ˆå‹•ç•«ï¼Œç„¶å¾Œåœåœ¨å¾—çè€…ä¸Š
      playRevealAnimation(winner, rank);
    });

    // é—œé–‰é ’ç
    socket.on('award:close', () => {
      document.getElementById('lottery-overlay').classList.remove('show');
      awardPlayers = [];
      awardWinners = [];
      currentAwardRank = 0;
    });

    // å»ºç«‹é ’çåå­—è»Œé“
    function buildAwardTrack() {
      const track = document.getElementById('lottery-names-track');
      const repeatCount = 10;
      let html = '';

      for (let i = 0; i < repeatCount; i++) {
        awardPlayers.forEach((player, index) => {
          html += `
            <div class="lottery-name-item" data-id="${player.id}" data-rank="${index + 1}">
              <div class="name">${player.name}</div>
              <div class="score">${player.score} åˆ†</div>
            </div>
          `;
        });
      }

      track.innerHTML = html;
      track.style.transform = 'translateX(0)';
      track.classList.remove('stopping');
    }

    // æ’­æ”¾æ­æ›‰å‹•ç•«
    function playRevealAnimation(winner, rank) {
      const track = document.getElementById('lottery-names-track');
      const itemWidth = 220;

      // ç§»é™¤ä¹‹å‰çš„ winner æ¨™è¨˜
      track.querySelectorAll('.lottery-name-item').forEach(item => {
        item.classList.remove('winner');
      });

      // å…ˆå¿«é€Ÿæ»¾å‹•
      let position = 0;
      const speed = 35;
      track.classList.remove('stopping');

      const spinDuration = 2000 + Math.random() * 1000; // 2-3ç§’æ»¾å‹•
      const startTime = Date.now();

      const animate = () => {
        const elapsed = Date.now() - startTime;

        if (elapsed < spinDuration) {
          position -= speed;
          track.style.transform = `translateX(${position}px)`;

          // ç„¡é™å¾ªç’°
          const totalWidth = awardPlayers.length * itemWidth;
          if (Math.abs(position) >= totalWidth * 3) {
            position += totalWidth;
          }

          requestAnimationFrame(animate);
        } else {
          // åœæ­¢ä¸¦å®šä½åˆ°å¾—çè€…
          const winnerIndex = awardPlayers.findIndex(p => p.id === winner.id);
          const containerCenter = 300;
          const targetPosition = -(winnerIndex * itemWidth + awardPlayers.length * 4 * itemWidth) + containerCenter - itemWidth / 2;

          track.classList.add('stopping');
          track.style.transform = `translateX(${targetPosition}px)`;

          // ç­‰å¾…å‹•ç•«å®Œæˆ
          setTimeout(() => {
            // æ¨™è¨˜å¾—çè€…
            const winnerItems = track.querySelectorAll(`[data-id="${winner.id}"]`);
            winnerItems.forEach(item => item.classList.add('winner'));

            // é¡¯ç¤ºå¾—çè€…è³‡è¨Š
            showAwardWinner(winner, rank);

            // æ·»åŠ åˆ°å·²å¾—çåˆ—è¡¨
            awardWinners.push({ ...winner, rank });
            updateAwardWinnersList();

            // æ”¾å½©å¸¶
            launchConfetti();

            // æ›´æ–°æç¤º
            if (currentAwardRank < awardPrizeCount) {
              document.getElementById('lottery-hint').textContent = 'ç­‰å¾…æ­æ›‰ä¸‹ä¸€ä½å¾—çè€…...';
            } else {
              document.getElementById('lottery-hint').textContent = 'ğŸŠ é ’çå…¸ç¦®åœ“æ»¿çµæŸï¼';
            }

            isRevealing = false;
          }, 3000);
        }
      };

      requestAnimationFrame(animate);
    }

    // é¡¯ç¤ºå¾—çè€…
    function showAwardWinner(winner, rank) {
      const display = document.getElementById('lottery-winner-display');
      let rankEmoji = 'ğŸ–ï¸';
      if (rank === 1) rankEmoji = 'ğŸ¥‡';
      else if (rank === 2) rankEmoji = 'ğŸ¥ˆ';
      else if (rank === 3) rankEmoji = 'ğŸ¥‰';

      display.innerHTML = `
        <div class="lottery-winner-name">${rankEmoji} ç¬¬ ${rank} å ${rankEmoji}</div>
        <div class="lottery-winner-name" style="font-size: 3rem; margin-top: 10px;">${winner.name}</div>
        <div class="lottery-winner-score">ç©åˆ†ï¼š${winner.score} åˆ†</div>
      `;
    }

    // æ›´æ–°å·²å¾—çåˆ—è¡¨
    function updateAwardWinnersList() {
      const container = document.getElementById('lottery-winners-container');

      if (awardWinners.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.5); font-size: 0.9rem;">ç­‰å¾…æ­æ›‰...</p>';
        return;
      }

      container.innerHTML = awardWinners.map((winner) => {
        let rankClass = '';
        if (winner.rank === 1) rankClass = 'gold';
        else if (winner.rank === 2) rankClass = 'silver';
        else if (winner.rank === 3) rankClass = 'bronze';

        return `
          <div class="lottery-winner-item">
            <span class="rank ${rankClass}">${winner.rank}</span>
            <span style="flex: 1; margin-left: 10px;">${winner.name}</span>
            <span style="color: #FFD93D;">${winner.score}</span>
          </div>
        `;
      }).join('');
    }
  </script>
</body>
</html>
